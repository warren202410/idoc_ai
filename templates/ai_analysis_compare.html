{% extends "base.html" %}

{% block title %}文档对比 - iDOC{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<style>
    body {
        background-color: #f8fafc;
        min-height: 100vh;
        font-family: 'Inter', sans-serif;
    }
    
    .compare-layout {
        display: flex;
        height: calc(100vh - 1rem);
        gap: 0;
    }
    
    .compare-main {
        flex: 1;
        display: flex;
        flex-direction: column;
        background-color: #f8fafc;
    }
    
    .main-header {
        background: white;
        padding: 2rem;
        border-bottom: 1px solid #e2e8f0;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    
    .main-title {
        font-size: 1.875rem;
        font-weight: 700;
        color: #1e293b;
        margin: 0;
    }
    
    .main-subtitle {
        color: #64748b;
        font-size: 1rem;
        margin-top: 0.5rem;
    }
    
    .content-area {
        flex: 1;
        padding: 2rem;
        overflow-y: auto;
    }
    
    .upload-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }
    
    .upload-panel {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        border: 1px solid #e2e8f0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .panel-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .panel-icon {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        background-color: #4f46e5;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
    }
    
    .panel-icon.document-a { background-color: #10b981; }
    .panel-icon.document-b { background-color: #f59e0b; }
    
    .upload-zone {
        border: 2px dashed #cbd5e1;
        border-radius: 8px;
        padding: 2.5rem 1.5rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #fafafa;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    .upload-zone:hover {
        border-color: #4f46e5;
        background: #f8fafc;
    }
    
    .upload-zone.dragover {
        border-color: #4f46e5;
        background: #f1f5f9;
        transform: scale(1.02);
    }
    
    .upload-zone.has-file {
        border-color: #10b981;
        background: #f0fdf4;
    }
    
    .upload-icon {
        width: 48px;
        height: 48px;
        border-radius: 8px;
        background-color: #4f46e5;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        margin: 0 auto 1rem;
    }
    
    .upload-text {
        font-size: 1rem;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 0.5rem;
    }
    
    .upload-hint {
        color: #64748b;
        font-size: 0.85rem;
        margin-bottom: 1rem;
    }
    
    .file-info {
        display: none;
        padding: 1rem;
        background: #f8fafc;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
        margin-top: 1rem;
    }
    
    .file-info.show {
        display: block;
    }
    
    .file-name {
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 0.5rem;
    }
    
    .file-meta {
        color: #64748b;
        font-size: 0.8rem;
        display: flex;
        gap: 1rem;
    }
    
    .compare-options {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid #e2e8f0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .section-icon {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        background-color: #4f46e5;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
    }
    
    .options-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }
    
    .option-group {
        background: #f8fafc;
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }
    
    .group-title {
        font-weight: 600;
        margin-bottom: 1rem;
        color: #1e293b;
        font-size: 1rem;
    }
    
    .form-group {
        margin-bottom: 1rem;
    }
    
    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #374151;
        font-size: 0.9rem;
    }
    
    .form-control {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.9rem;
        transition: border-color 0.2s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #4f46e5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    
    .form-check {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem;
        padding: 0.5rem;
        background: white;
        border-radius: 4px;
        transition: background-color 0.2s ease;
    }
    
    .form-check:hover {
        background: #f9fafb;
    }
    
    .form-check-input {
        margin-right: 0.5rem;
    }
    
    .form-check-label {
        color: #374151;
        font-size: 0.85rem;
        cursor: pointer;
        flex: 1;
    }
    
    .results-section {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        border: 1px solid #e2e8f0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        display: none;
    }
    
    .results-section.show {
        display: block;
    }
    
    .comparison-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #f1f5f9;
    }
    
    .comparison-summary {
        display: flex;
        gap: 2rem;
    }
    
    .summary-item {
        text-align: center;
    }
    
    .summary-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 0.25rem;
    }
    
    .summary-label {
        color: #64748b;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .similarity-score {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .score-circle {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: conic-gradient(#4f46e5 0deg 252deg, #e5e7eb 252deg 360deg);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }
    
    .score-circle::before {
        content: '';
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: white;
        position: absolute;
    }
    
    .score-text {
        position: relative;
        z-index: 1;
        font-weight: 700;
        color: #1e293b;
        font-size: 1rem;
    }
    
    .score-info {
        color: #64748b;
        font-size: 0.9rem;
    }
    
    .comparison-tabs {
        display: flex;
        border-bottom: 1px solid #e2e8f0;
        margin-bottom: 2rem;
    }
    
    .tab-button {
        padding: 1rem 1.5rem;
        border: none;
        background: transparent;
        color: #64748b;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s ease;
        border-bottom: 2px solid transparent;
    }
    
    .tab-button:hover {
        color: #374151;
    }
    
    .tab-button.active {
        color: #4f46e5;
        border-bottom-color: #4f46e5;
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
    
    .diff-view {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }
    
    .document-panel {
        background: #f8fafc;
        border-radius: 8px;
        padding: 1.5rem;
        border: 1px solid #e2e8f0;
    }
    
    .document-title {
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .document-content {
        font-size: 0.9rem;
        line-height: 1.6;
        color: #374151;
        max-height: 400px;
        overflow-y: auto;
    }
    
    .highlight-added {
        background-color: rgba(16, 185, 129, 0.1);
        color: #059669;
        padding: 0.125rem 0.25rem;
        border-radius: 3px;
    }
    
    .highlight-removed {
        background-color: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        padding: 0.125rem 0.25rem;
        border-radius: 3px;
        text-decoration: line-through;
    }
    
    .highlight-modified {
        background-color: rgba(245, 158, 11, 0.1);
        color: #d97706;
        padding: 0.125rem 0.25rem;
        border-radius: 3px;
    }
    
    .changes-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .change-item {
        padding: 1rem;
        border-radius: 8px;
        border-left: 4px solid;
    }
    
    .change-item.added {
        background: rgba(16, 185, 129, 0.05);
        border-left-color: #10b981;
    }
    
    .change-item.removed {
        background: rgba(239, 68, 68, 0.05);
        border-left-color: #ef4444;
    }
    
    .change-item.modified {
        background: rgba(245, 158, 11, 0.05);
        border-left-color: #f59e0b;
    }
    
    .change-type {
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
    }
    
    .change-type.added { color: #059669; }
    .change-type.removed { color: #dc2626; }
    .change-type.modified { color: #d97706; }
    
    .change-text {
        color: #374151;
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    .statistics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }
    
    .stat-card {
        background: #f8fafc;
        border-radius: 8px;
        padding: 1.5rem;
        border: 1px solid #e2e8f0;
        text-align: center;
    }
    
    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        color: #64748b;
        font-size: 0.85rem;
    }
    
    .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 6px;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: none;
        cursor: pointer;
    }
    
    .btn-primary {
        background-color: #4f46e5;
        color: white;
        border: 1px solid #4f46e5;
    }
    
    .btn-primary:hover {
        background-color: #4338ca;
        border-color: #4338ca;
        color: white;
        text-decoration: none;
    }
    
    .btn-secondary {
        background-color: white;
        color: #374151;
        border: 1px solid #d1d5db;
    }
    
    .btn-secondary:hover {
        background-color: #f9fafb;
        border-color: #9ca3af;
        color: #374151;
        text-decoration: none;
    }
    
    .action-bar {
        background: white;
        padding: 1.5rem 2rem;
        border-top: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.05);
    }
    
    .status-info {
        display: flex;
        align-items: center;
        gap: 1rem;
        color: #64748b;
        font-size: 0.9rem;
    }
    
    .btn-group {
        display: flex;
        gap: 0.75rem;
    }
    
    @media (max-width: 1024px) {
        .upload-section {
            grid-template-columns: 1fr;
        }
        
        .diff-view {
            grid-template-columns: 1fr;
        }
        
        .options-grid {
            grid-template-columns: 1fr;
        }
        
        .statistics-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-layout">
    <!-- 左侧导航栏 -->
    <div class="sidebar">
        <div class="sidebar-brand">
            <a href="{{ url_for('dashboard') }}">
                <div class="sidebar-brand-icon">
                    <img src="{{ url_for('static', filename='img/logo-icon.svg') }}" alt="Logo Icon" onerror="this.src='{{ url_for('static', filename='img/default-logo.png') }}'">
                </div>
                <div class="sidebar-brand-text">
                    <img src="{{ url_for('static', filename='img/logo-text.svg') }}" alt="Logo Text" onerror="this.src='{{ url_for('static', filename='img/default-logo-text.png') }}'">
                    <span>iDOC</span>
                </div>
            </a>
        </div>
        
        <!-- 导航菜单 -->
        <div class="sidebar-nav">
            <a href="{{ url_for('dashboard') }}" class="nav-item">
                <i class="fas fa-tachometer-alt"></i>
                <span>仪表板</span>
            </a>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseKnowledgeBase" aria-expanded="false">
                <i class="fas fa-book"></i>
                <span>企业知识库</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseKnowledgeBase">
                <a href="{{ url_for('knowledge_base') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-folder-open"></i>
                    <span>所有知识库</span>
                </a>
                <a href="{{ url_for('knowledge_base') }}?action=import" class="nav-item ms-4 py-2">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>导入知识</span>
                </a>
                <a href="{{ url_for('knowledge_base') }}?action=settings" class="nav-item ms-4 py-2">
                    <i class="fas fa-cogs"></i>
                    <span>知识库设置</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseDocuments" aria-expanded="false">
                <i class="fas fa-file-alt"></i>
                <span>文档管理</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseDocuments">
                <a href="{{ url_for('documents_list') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-list"></i>
                    <span>所有文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}?action=upload" class="nav-item ms-4 py-2">
                    <i class="fas fa-upload"></i>
                    <span>上传文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}?action=recent" class="nav-item ms-4 py-2">
                    <i class="fas fa-clock"></i>
                    <span>最近文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}?action=starred" class="nav-item ms-4 py-2">
                    <i class="fas fa-star"></i>
                    <span>星标文档</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseWorkflow" aria-expanded="false">
                <i class="fas fa-project-diagram"></i>
                <span>智能流程设计</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseWorkflow">
                <a href="{{ url_for('workflow_create') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-plus"></i>
                    <span>创建智能流程</span>
                </a>
                <a href="{{ url_for('workflow_create') }}?action=templates" class="nav-item ms-4 py-2">
                    <i class="fas fa-clipboard-list"></i>
                    <span>流程模板库</span>
                </a>
                <a href="{{ url_for('workflow_create') }}?action=running" class="nav-item ms-4 py-2">
                    <i class="fas fa-play-circle"></i>
                    <span>运行中流程</span>
                </a>
                <a href="{{ url_for('workflow_create') }}?action=history" class="nav-item ms-4 py-2">
                    <i class="fas fa-history"></i>
                    <span>流程执行历史</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseAnalysis" aria-expanded="true">
                <i class="fas fa-chart-bar"></i>
                <span>AI分析</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse show" id="collapseAnalysis">
                <a href="{{ url_for('ai_analysis') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-search"></i>
                    <span>内容分析</span>
                </a>
                <a href="{{ url_for('ai_analysis') }}?action=compare" class="nav-item ms-4 py-2 active">
                    <i class="fas fa-not-equal"></i>
                    <span>文档对比</span>
                </a>
                <a href="{{ url_for('ai_analysis') }}?action=extract" class="nav-item ms-4 py-2">
                    <i class="fas fa-filter"></i>
                    <span>信息提取</span>
                </a>
                <a href="{{ url_for('ai_analysis') }}?action=summary" class="nav-item ms-4 py-2">
                    <i class="fas fa-compress-alt"></i>
                    <span>文档摘要</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseAgent" aria-expanded="false">
                <i class="fas fa-robot"></i>
                <span>Agent Chat</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseAgent">
                <a href="{{ url_for('agent_chat') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-comments"></i>
                    <span>新会话</span>
                </a>
                <a href="{{ url_for('agent_chat_history') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-history"></i>
                    <span>聊天历史</span>
                </a>
                <a href="{{ url_for('multi_agent_workshop') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-users-cog"></i>
                    <span>多Agent协作</span>
                </a>
                <a href="{{ url_for('agent_settings') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-sliders-h"></i>
                    <span>Agent设置</span>
                </a>
            </div>
            
            <div class="nav-section">用户</div>
            
            <a href="{{ url_for('account_settings') }}" class="nav-item">
                <i class="fas fa-user-cog"></i>
                <span>账户设置</span>
            </a>
            
            <a href="{{ url_for('notifications') }}" class="nav-item">
                <i class="fas fa-bell"></i>
                <span>通知</span>
                <span class="badge rounded-pill bg-primary ms-auto">3</span>
            </a>
            
            <a href="{{ url_for('logout') }}" class="nav-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>退出登录</span>
            </a>
        </div>
    </div>
    
    <!-- 主要文档对比界面 -->
    <div class="main-content">
        <div class="compare-layout">
            <div class="compare-main">
                <div class="main-header">
                    <h1 class="main-title">智能文档对比</h1>
                    <p class="main-subtitle">通过AI技术精准识别文档间的差异，支持内容、结构、格式的全方位对比分析</p>
                </div>
                
                <div class="content-area">
                    <!-- 文档上传区域 -->
                    <div class="upload-section">
                        <div class="upload-panel">
                            <h3 class="panel-title">
                                <div class="panel-icon document-a">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                文档 A（基准版本）
                            </h3>
                            
                            <div class="upload-zone" id="upload-zone-a">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="upload-text">上传基准文档</div>
                                <div class="upload-hint">支持 PDF、Word、TXT 格式</div>
                                <input type="file" id="file-input-a" accept=".pdf,.doc,.docx,.txt" style="display: none;">
                            </div>
                            
                            <div class="file-info" id="file-info-a">
                                <div class="file-name" id="file-name-a"></div>
                                <div class="file-meta" id="file-meta-a"></div>
                            </div>
                        </div>
                        
                        <div class="upload-panel">
                            <h3 class="panel-title">
                                <div class="panel-icon document-b">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                文档 B（对比版本）
                            </h3>
                            
                            <div class="upload-zone" id="upload-zone-b">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="upload-text">上传对比文档</div>
                                <div class="upload-hint">支持 PDF、Word、TXT 格式</div>
                                <input type="file" id="file-input-b" accept=".pdf,.doc,.docx,.txt" style="display: none;">
                            </div>
                            
                            <div class="file-info" id="file-info-b">
                                <div class="file-name" id="file-name-b"></div>
                                <div class="file-meta" id="file-meta-b"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 对比选项 -->
                    <div class="compare-options">
                        <h3 class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-sliders-h"></i>
                            </div>
                            对比配置
                        </h3>
                        
                        <div class="options-grid">
                            <div class="option-group">
                                <div class="group-title">对比类型</div>
                                
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="compare-content" checked>
                                    <label class="form-check-label" for="compare-content">
                                        内容对比
                                    </label>
                                </div>
                                
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="compare-structure" checked>
                                    <label class="form-check-label" for="compare-structure">
                                        结构对比
                                    </label>
                                </div>
                                
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="compare-format">
                                    <label class="form-check-label" for="compare-format">
                                        格式对比
                                    </label>
                                </div>
                            </div>
                            
                            <div class="option-group">
                                <div class="group-title">对比精度</div>
                                
                                <div class="form-group">
                                    <label class="form-label">相似度阈值</label>
                                    <select class="form-control" id="similarity-threshold">
                                        <option value="0.7">70% - 宽松</option>
                                        <option value="0.8" selected>80% - 标准</option>
                                        <option value="0.9">90% - 严格</option>
                                    </select>
                                </div>
                                
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="ignore-whitespace" checked>
                                    <label class="form-check-label" for="ignore-whitespace">
                                        忽略空白字符
                                    </label>
                                </div>
                                
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="ignore-case">
                                    <label class="form-check-label" for="ignore-case">
                                        忽略大小写
                                    </label>
                                </div>
                            </div>
                            
                            <div class="option-group">
                                <div class="group-title">输出选项</div>
                                
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="generate-report" checked>
                                    <label class="form-check-label" for="generate-report">
                                        生成对比报告
                                    </label>
                                </div>
                                
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="save-results">
                                    <label class="form-check-label" for="save-results">
                                        保存对比结果
                                    </label>
                                </div>
                                
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="highlight-changes" checked>
                                    <label class="form-check-label" for="highlight-changes">
                                        高亮显示差异
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 对比结果 -->
                    <div class="results-section" id="results-section">
                        <div class="comparison-header">
                            <div class="comparison-summary">
                                <div class="summary-item">
                                    <div class="summary-value">70%</div>
                                    <div class="summary-label">相似度</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-value">23</div>
                                    <div class="summary-label">差异数量</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-value">8</div>
                                    <div class="summary-label">新增内容</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-value">5</div>
                                    <div class="summary-label">删除内容</div>
                                </div>
                            </div>
                            
                            <div class="similarity-score">
                                <div class="score-circle">
                                    <div class="score-text">70%</div>
                                </div>
                                <div class="score-info">整体相似度</div>
                            </div>
                        </div>
                        
                        <div class="comparison-tabs">
                            <button class="tab-button active" data-tab="diff" onclick="switchTab('diff')">
                                差异对比
                            </button>
                            <button class="tab-button" data-tab="changes" onclick="switchTab('changes')">
                                变更列表
                            </button>
                            <button class="tab-button" data-tab="statistics" onclick="switchTab('statistics')">
                                统计分析
                            </button>
                        </div>
                        
                        <!-- 差异对比视图 -->
                        <div class="tab-content active" id="diff-tab">
                            <div class="diff-view">
                                <div class="document-panel">
                                    <div class="document-title">文档 A（基准版本）</div>
                                    <div class="document-content">
                                        企业在数字化转型的过程中，需要建立完善的<span class="highlight-removed">信息管理</span>体系，确保数据的准确性和安全性。通过引入人工智能技术，可以大幅提升<span class="highlight-modified">工作效率</span>，降低运营成本。
                                        
                                        <br><br>我们的解决方案包括：
                                        <br>1. 智能文档处理系统
                                        <br>2. 自动化工作流程
                                        <br>3. 数据分析平台
                                        
                                        <br><br>预期在未来6个月内，企业的<span class="highlight-removed">整体效率</span>将提升30%以上。
                                    </div>
                                </div>
                                
                                <div class="document-panel">
                                    <div class="document-title">文档 B（对比版本）</div>
                                    <div class="document-content">
                                        企业在数字化转型的过程中，需要建立完善的<span class="highlight-added">知识管理</span>体系，确保数据的准确性和安全性。通过引入人工智能技术，可以大幅提升<span class="highlight-modified">运营效率</span>，降低运营成本。
                                        
                                        <br><br>我们的解决方案包括：
                                        <br>1. 智能文档处理系统
                                        <br>2. 自动化工作流程
                                        <br>3. 数据分析平台
                                        <br><span class="highlight-added">4. AI智能助手</span>
                                        
                                        <br><br>预期在未来6个月内，企业的<span class="highlight-added">生产效率</span>将提升30%以上。
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 变更列表视图 -->
                        <div class="tab-content" id="changes-tab">
                            <div class="changes-list">
                                <div class="change-item modified">
                                    <div class="change-type modified">修改</div>
                                    <div class="change-text">
                                        第1段："信息管理" → "知识管理"
                                    </div>
                                </div>
                                
                                <div class="change-item modified">
                                    <div class="change-type modified">修改</div>
                                    <div class="change-text">
                                        第1段："工作效率" → "运营效率"
                                    </div>
                                </div>
                                
                                <div class="change-item added">
                                    <div class="change-type added">新增</div>
                                    <div class="change-text">
                                        第2段：新增列表项 "4. AI智能助手"
                                    </div>
                                </div>
                                
                                <div class="change-item modified">
                                    <div class="change-type modified">修改</div>
                                    <div class="change-text">
                                        第3段："整体效率" → "生产效率"
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 统计分析视图 -->
                        <div class="tab-content" id="statistics-tab">
                            <div class="statistics-grid">
                                <div class="stat-card">
                                    <div class="stat-value">245</div>
                                    <div class="stat-label">总字符数（文档A）</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-value">267</div>
                                    <div class="stat-label">总字符数（文档B）</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-value">89%</div>
                                    <div class="stat-label">内容重叠度</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-value">12</div>
                                    <div class="stat-label">修改位置</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-value">22</div>
                                    <div class="stat-label">新增字符</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-value">0</div>
                                    <div class="stat-label">删除字符</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 底部操作栏 -->
                <div class="action-bar">
                    <div class="status-info">
                        <span id="comparison-status">请上传两个文档进行对比</span>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="resetComparison()">
                            <i class="fas fa-undo"></i>
                            重置
                        </button>
                        <button class="btn btn-primary" id="start-comparison" onclick="startComparison()" disabled>
                            <i class="fas fa-balance-scale"></i>
                            开始对比
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let documentA = null;
    let documentB = null;
    
    document.addEventListener('DOMContentLoaded', function() {
        initializeUploads();
    });
    
    function initializeUploads() {
        // 文档A上传
        const uploadZoneA = document.getElementById('upload-zone-a');
        const fileInputA = document.getElementById('file-input-a');
        
        uploadZoneA.addEventListener('click', () => fileInputA.click());
        fileInputA.addEventListener('change', (e) => handleFileUpload(e, 'a'));
        
        // 文档B上传
        const uploadZoneB = document.getElementById('upload-zone-b');
        const fileInputB = document.getElementById('file-input-b');
        
        uploadZoneB.addEventListener('click', () => fileInputB.click());
        fileInputB.addEventListener('change', (e) => handleFileUpload(e, 'b'));
        
        // 拖拽功能
        [uploadZoneA, uploadZoneB].forEach((zone, index) => {
            const type = index === 0 ? 'a' : 'b';
            
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('dragover');
            });
            
            zone.addEventListener('dragleave', () => {
                zone.classList.remove('dragover');
            });
            
            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                if (files.length > 0) {
                    handleFile(files[0], type);
                }
            });
        });
    }
    
    function handleFileUpload(e, type) {
        const files = Array.from(e.target.files);
        if (files.length > 0) {
            handleFile(files[0], type);
        }
    }
    
    function handleFile(file, type) {
        if (!isValidFile(file)) {
            alert('不支持的文件格式或文件过大');
            return;
        }
        
        if (type === 'a') {
            documentA = file;
        } else {
            documentB = file;
        }
        
        updateFileInfo(file, type);
        updateComparisonButton();
    }
    
    function isValidFile(file) {
        const validTypes = [
            'application/pdf',
            'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            'application/msword',
            'text/plain'
        ];
        
        const maxSize = 50 * 1024 * 1024; // 50MB
        return validTypes.includes(file.type) && file.size <= maxSize;
    }
    
    function updateFileInfo(file, type) {
        const uploadZone = document.getElementById(`upload-zone-${type}`);
        const fileInfo = document.getElementById(`file-info-${type}`);
        const fileName = document.getElementById(`file-name-${type}`);
        const fileMeta = document.getElementById(`file-meta-${type}`);
        
        uploadZone.classList.add('has-file');
        fileInfo.classList.add('show');
        fileName.textContent = file.name;
        fileMeta.innerHTML = `
            <span>大小: ${formatFileSize(file.size)}</span>
            <span>类型: ${getFileType(file.type)}</span>
            <span>修改时间: ${new Date(file.lastModified).toLocaleDateString()}</span>
        `;
    }
    
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function getFileType(mimeType) {
        const types = {
            'application/pdf': 'PDF',
            'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'Word',
            'application/msword': 'Word',
            'text/plain': 'TXT'
        };
        return types[mimeType] || '未知';
    }
    
    function updateComparisonButton() {
        const btn = document.getElementById('start-comparison');
        const status = document.getElementById('comparison-status');
        
        if (documentA && documentB) {
            btn.disabled = false;
            status.textContent = '已选择两个文档，可以开始对比';
        } else if (documentA || documentB) {
            btn.disabled = true;
            status.textContent = '请上传第二个文档';
        } else {
            btn.disabled = true;
            status.textContent = '请上传两个文档进行对比';
        }
    }
    
    function startComparison() {
        if (!documentA || !documentB) {
            alert('请上传两个文档');
            return;
        }
        
        // 显示结果区域
        const resultsSection = document.getElementById('results-section');
        resultsSection.classList.add('show');
        
        // 更新状态
        document.getElementById('comparison-status').textContent = '对比完成';
        
        // 滚动到结果区域
        resultsSection.scrollIntoView({ behavior: 'smooth' });
    }
    
    function switchTab(tabName) {
        // 更新tab按钮状态
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        
        // 更新tab内容
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`${tabName}-tab`).classList.add('active');
    }
    
    function resetComparison() {
        documentA = null;
        documentB = null;
        
        // 重置上传区域
        ['a', 'b'].forEach(type => {
            const uploadZone = document.getElementById(`upload-zone-${type}`);
            const fileInfo = document.getElementById(`file-info-${type}`);
            const fileInput = document.getElementById(`file-input-${type}`);
            
            uploadZone.classList.remove('has-file');
            fileInfo.classList.remove('show');
            fileInput.value = '';
        });
        
        // 隐藏结果区域
        document.getElementById('results-section').classList.remove('show');
        
        updateComparisonButton();
    }
</script>
{% endblock %}