{% extends "base.html" %}

{% block title %}AI分析 - iDOC{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: #f5f8fa;
        min-height: 100vh;
        font-family: 'Inter', sans-serif;
    }
    
    .dashboard-layout {
        display: flex;
        min-height: calc(100vh - 1rem);
    }
    
    .sidebar {
        width: 250px;
        background-color: #fff;
        border-right: 1px solid #e5e9f2;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        position: fixed;
        height: 100vh;
        z-index: 1000;
    }
    
    .sidebar-brand {
        padding: 1.5rem;
        border-bottom: 1px solid #e5e9f2;
    }
    
    .sidebar-brand a {
        display: flex;
        align-items: center;
        text-decoration: none;
        color: inherit;
    }
    
    .sidebar-brand-icon {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 0.75rem;
    }
    
    .sidebar-brand-icon img {
        max-width: 100%;
        max-height: 100%;
    }
    
    .sidebar-brand-text {
        display: flex;
        flex-direction: column;
    }
    
    .sidebar-brand-text img {
        height: 20px;
        margin-bottom: 0.25rem;
    }
    
    .sidebar-brand-text span {
        font-size: 0.75rem;
        color: #6c757d;
    }
    
    .sidebar-nav {
        padding: 1.5rem 0;
        overflow-y: auto;
        height: calc(100vh - 85px);
    }
    
    .nav-section {
        padding: 0.75rem 1.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        color: #6c757d;
        margin-top: 0.5rem;
    }
    
    .nav-item {
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        color: #495057;
        text-decoration: none;
        transition: all 0.2s ease;
        cursor: pointer;
    }
    
    .nav-item:hover {
        background-color: rgba(74, 108, 247, 0.05);
        color: #4A6CF7;
    }
    
    .nav-item.active {
        background-color: rgba(74, 108, 247, 0.1);
        color: #4A6CF7;
        font-weight: 500;
    }
    
    .nav-item i {
        margin-right: 0.75rem;
        width: 20px;
        text-align: center;
    }
    
    .main-content {
        flex: 1;
        margin-left: 250px;
        padding: 2rem;
    }
    
    .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }
    
    .page-title {
        margin: 0;
        font-weight: 600;
    }
    
    /* AI Analysis Specific Styles */
    .analysis-container {
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        margin-bottom: 2rem;
        overflow: hidden;
    }
    
    .analysis-header {
        padding: 1.5rem;
        border-bottom: 1px solid #e5e9f2;
        background-color: #f8f9fa;
    }
    
    .analysis-body {
        padding: 1.5rem;
    }
    
    .analysis-footer {
        padding: 1.5rem;
        border-top: 1px solid #e5e9f2;
        background-color: #f8f9fa;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .upload-area {
        border: 2px dashed #dce0e5;
        border-radius: 12px;
        padding: 3rem 2rem;
        text-align: center;
        margin-bottom: 2rem;
        transition: all 0.2s ease;
        cursor: pointer;
    }
    
    .upload-area.active {
        border-color: #4A6CF7;
        background-color: rgba(74, 108, 247, 0.05);
    }
    
    .upload-icon {
        font-size: 3rem;
        color: #adb5bd;
        margin-bottom: 1rem;
    }
    
    .upload-text {
        font-size: 1.25rem;
        font-weight: 500;
        margin-bottom: 0.5rem;
    }
    
    .upload-hint {
        color: #6c757d;
        margin-bottom: 1.5rem;
    }
    
    .ai-chat-container {
        display: flex;
        flex-direction: column;
        height: 500px;
    }
    
    .ai-chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background-color: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 1rem;
    }
    
    .ai-chat-input {
        display: flex;
        gap: 0.5rem;
    }
    
    .ai-chat-input input {
        flex: 1;
        padding: 0.75rem 1rem;
        border: 1px solid #dce0e5;
        border-radius: 8px;
    }
    
    .message {
        margin-bottom: 1rem;
        max-width: 80%;
    }
    
    .message-user {
        align-self: flex-end;
        margin-left: auto;
        background-color: #4A6CF7;
        color: white;
        border-radius: 12px 12px 0 12px;
        padding: 0.75rem 1rem;
    }
    
    .message-ai {
        align-self: flex-start;
        background-color: white;
        border: 1px solid #e5e9f2;
        border-radius: 12px 12px 12px 0;
        padding: 0.75rem 1rem;
    }
    
    .message-time {
        font-size: 0.75rem;
        color: #adb5bd;
        margin-top: 0.25rem;
        text-align: right;
    }
    
    /* Tabs Navigation */
    .analysis-tabs {
        display: flex;
        border-bottom: 1px solid #e5e9f2;
        margin-bottom: 1.5rem;
    }
    
    .analysis-tab {
        padding: 0.75rem 1.5rem;
        cursor: pointer;
        position: relative;
        color: #6c757d;
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    .analysis-tab:hover {
        color: #4A6CF7;
    }
    
    .analysis-tab.active {
        color: #4A6CF7;
    }
    
    .analysis-tab.active::after {
        content: '';
        position: absolute;
        left: 0;
        right: 0;
        bottom: -1px;
        height: 2px;
        background-color: #4A6CF7;
    }
    
    /* Analysis Results Styles */
    .analysis-results {
        margin-top: 2rem;
    }
    
    .result-section {
        margin-bottom: 2rem;
    }
    
    .result-section-title {
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
    }
    
    .result-section-title i {
        margin-right: 0.5rem;
        color: #4A6CF7;
    }
    
    .result-card {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1.25rem;
        margin-bottom: 1rem;
    }
    
    .result-card-title {
        font-weight: 600;
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .result-card-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    .badge-positive {
        background-color: rgba(40, 167, 69, 0.1);
        color: #28a745;
    }
    
    .badge-negative {
        background-color: rgba(220, 53, 69, 0.1);
        color: #dc3545;
    }
    
    .badge-neutral {
        background-color: rgba(108, 117, 125, 0.1);
        color: #6c757d;
    }
    
    .badge-warning {
        background-color: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }
    
    .result-card-content {
        font-size: 0.9rem;
        color: #495057;
    }
    
    .progress-container {
        margin-bottom: 0.75rem;
    }
    
    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.25rem;
    }
    
    .progress-label-text {
        font-weight: 500;
        font-size: 0.85rem;
    }
    
    .progress-label-value {
        font-size: 0.85rem;
        color: #6c757d;
    }
    
    .progress {
        height: 0.5rem;
        border-radius: 0.25rem;
    }
    
    /* Contract Analysis Specific Styles */
    .contract-parties {
        margin-bottom: 1.5rem;
    }
    
    .party-card {
        display: flex;
        align-items: center;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
    }
    
    .party-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #4A6CF7;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
    }
    
    .party-info {
        flex: 1;
    }
    
    .party-name {
        font-weight: 600;
    }
    
    .party-role {
        font-size: 0.85rem;
        color: #6c757d;
    }
    
    .contract-timeline {
        margin-bottom: 1.5rem;
    }
    
    .timeline-item {
        display: flex;
        margin-bottom: 1rem;
    }
    
    .timeline-date {
        width: 120px;
        font-weight: 500;
    }
    
    .timeline-content {
        flex: 1;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        position: relative;
    }
    
    .timeline-content::before {
        content: '';
        position: absolute;
        top: 50%;
        left: -10px;
        margin-top: -10px;
        border: 10px solid transparent;
        border-right-color: #f8f9fa;
    }
    
    .obligation-card {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        border-left: 4px solid #4A6CF7;
    }
    
    /* Financial Document Analysis Specific Styles */
    .financial-summary {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .financial-metric {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1.25rem;
        text-align: center;
    }
    
    .metric-value {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    
    .metric-label {
        font-size: 0.85rem;
        color: #6c757d;
    }
    
    .metric-change {
        font-size: 0.8rem;
        margin-top: 0.5rem;
    }
    
    .metric-change.positive {
        color: #28a745;
    }
    
    .metric-change.negative {
        color: #dc3545;
    }
    
    .chart-container {
        width: 100%;
        height: 300px;
        margin-bottom: 1.5rem;
    }
    
    /* Medical Document Analysis Specific Styles */
    .medical-summary {
        margin-bottom: 1.5rem;
    }
    
    .medical-info-row {
        display: flex;
        margin-bottom: 1rem;
    }
    
    .medical-info-label {
        width: 150px;
        font-weight: 500;
    }
    
    .medical-info-value {
        flex: 1;
    }
    
    .diagnosis-card {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        border-left: 4px solid #17a2b8;
    }
    
    .prescription-item {
        display: flex;
        align-items: center;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
    }
    
    .prescription-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background-color: rgba(23, 162, 184, 0.1);
        color: #17a2b8;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
    }
    
    .prescription-info {
        flex: 1;
    }
    
    .prescription-name {
        font-weight: 600;
    }
    
    .prescription-dosage {
        font-size: 0.85rem;
        color: #6c757d;
    }
    
    /* General Analysis Styles */
    .entity-list {
        margin-bottom: 1.5rem;
    }
    
    .entity-item {
        display: flex;
        align-items: center;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
    }
    
    .entity-type {
        width: 100px;
        font-weight: 500;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-right: 1rem;
        text-align: center;
    }
    
    .entity-type-person {
        background-color: rgba(111, 66, 193, 0.1);
        color: #6f42c1;
    }
    
    .entity-type-org {
        background-color: rgba(253, 126, 20, 0.1);
        color: #fd7e14;
    }
    
    .entity-type-date {
        background-color: rgba(32, 201, 151, 0.1);
        color: #20c997;
    }
    
    .entity-type-location {
        background-color: rgba(13, 110, 253, 0.1);
        color: #0d6efd;
    }
    
    .entity-text {
        flex: 1;
    }
    
    .sentiment-chart {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .sentiment-value {
        width: 60px;
        text-align: center;
        font-weight: 600;
    }
    
    .sentiment-meter {
        flex: 1;
        height: 8px;
        background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #28a745 100%);
        border-radius: 4px;
        position: relative;
    }
    
    .sentiment-marker {
        position: absolute;
        width: 16px;
        height: 16px;
        background-color: white;
        border: 2px solid #495057;
        border-radius: 50%;
        top: -4px;
        margin-left: -8px;
    }
    
    .keyword-cloud {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        text-align: center;
    }
    
    .keyword {
        display: inline-block;
        margin: 0.5rem;
        font-weight: 500;
    }
    
    .keyword-size-1 {
        font-size: 0.9rem;
        opacity: 0.7;
    }
    
    .keyword-size-2 {
        font-size: 1.1rem;
        opacity: 0.8;
    }
    
    .keyword-size-3 {
        font-size: 1.3rem;
        opacity: 0.9;
    }
    
    .keyword-size-4 {
        font-size: 1.5rem;
        opacity: 1;
    }
    
    .keyword-size-5 {
        font-size: 1.8rem;
        opacity: 1;
    }
    
    @media (max-width: 992px) {
        .main-content {
            margin-left: 64px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-layout">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-brand">
            <a href="{{ url_for('dashboard') }}">
                <div class="sidebar-brand-icon">
                    <img src="{{ url_for('static', filename='img/logo-icon.svg') }}" alt="Logo Icon" onerror="this.src='{{ url_for('static', filename='img/default-logo.png') }}'">
                </div>
                <div class="sidebar-brand-text">
                    <img src="{{ url_for('static', filename='img/logo-text.svg') }}" alt="Logo Text" onerror="this.src='{{ url_for('static', filename='img/default-logo-text.png') }}'">
                    <span>iDOC</span>
                </div>
            </a>
        </div>
        
        <div class="sidebar-nav">
            <a href="{{ url_for('dashboard') }}" class="nav-item">
                <i class="fas fa-tachometer-alt"></i>
                <span>仪表板</span>
            </a>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseKnowledgeBase" aria-expanded="false">
                <i class="fas fa-book"></i>
                <span>企业知识库</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseKnowledgeBase">
                <a href="{{ url_for('knowledge_base') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-folder-open"></i>
                    <span>所有知识库</span>
                </a>
                <a href="{{ url_for('knowledge_base') }}?action=import" class="nav-item ms-4 py-2">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>导入知识</span>
                </a>
                <a href="{{ url_for('knowledge_base') }}?action=settings" class="nav-item ms-4 py-2">
                    <i class="fas fa-cogs"></i>
                    <span>知识库设置</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseDocuments" aria-expanded="false">
                <i class="fas fa-file-alt"></i>
                <span>文档管理</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseDocuments">
                <a href="{{ url_for('documents_list') }}?action=upload" class="nav-item ms-4 py-2">
                    <i class="fas fa-file-upload"></i>
                    <span>上传文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-folder"></i>
                    <span>我的文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}?filter=shared" class="nav-item ms-4 py-2">
                    <i class="fas fa-share-alt"></i>
                    <span>共享文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}?filter=archived" class="nav-item ms-4 py-2">
                    <i class="fas fa-archive"></i>
                    <span>归档文档</span>
                </a>
            </div>
            
            <div class="nav-section">智能工具</div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseWorkflows" aria-expanded="false">
                <i class="fas fa-project-diagram"></i>
                <span>文档解析工作流</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseWorkflows">
                <a href="{{ url_for('workflow_create') }}?action=list" class="nav-item ms-4 py-2">
                    <i class="fas fa-list"></i>
                    <span>工作流列表</span>
                </a>
                <a href="{{ url_for('workflow_create') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-plus-circle"></i>
                    <span>创建工作流</span>
                </a>
                <a href="{{ url_for('workflow_create') }}?action=history" class="nav-item ms-4 py-2">
                    <i class="fas fa-history"></i>
                    <span>执行历史</span>
                </a>
                <a href="{{ url_for('workflow_create') }}?action=templates" class="nav-item ms-4 py-2">
                    <i class="fas fa-puzzle-piece"></i>
                    <span>模板市场</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseAnalysis" aria-expanded="true">
                <i class="fas fa-chart-line"></i>
                <span>AI分析</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse show" id="collapseAnalysis">
                {% if request.args.get('type') == 'contract' %}
                <a href="{{ url_for('ai_analysis') }}?type=contract" class="nav-item ms-4 py-2 active">
                    <i class="fas fa-file-contract"></i>
                    <span>合同分析</span>
                </a>
                {% else %}
                <a href="{{ url_for('ai_analysis') }}?type=contract" class="nav-item ms-4 py-2">
                    <i class="fas fa-file-contract"></i>
                    <span>合同分析</span>
                </a>
                {% endif %}
                
                {% if request.args.get('type') == 'finance' %}
                <a href="{{ url_for('ai_analysis') }}?type=finance" class="nav-item ms-4 py-2 active">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>财务文档分析</span>
                </a>
                {% else %}
                <a href="{{ url_for('ai_analysis') }}?type=finance" class="nav-item ms-4 py-2">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>财务文档分析</span>
                </a>
                {% endif %}
                
                {% if request.args.get('type') == 'medical' %}
                <a href="{{ url_for('ai_analysis') }}?type=medical" class="nav-item ms-4 py-2 active">
                    <i class="fas fa-file-medical"></i>
                    <span>医疗文档分析</span>
                </a>
                {% else %}
                <a href="{{ url_for('ai_analysis') }}?type=medical" class="nav-item ms-4 py-2">
                    <i class="fas fa-file-medical"></i>
                    <span>医疗文档分析</span>
                </a>
                {% endif %}
                
                {% if not request.args.get('type') %}
                <a href="{{ url_for('ai_analysis') }}" class="nav-item ms-4 py-2 active">
                    <i class="fas fa-file-alt"></i>
                    <span>通用文档分析</span>
                </a>
                {% else %}
                <a href="{{ url_for('ai_analysis') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-file-alt"></i>
                    <span>通用文档分析</span>
                </a>
                {% endif %}
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseAgentChat" aria-expanded="false">
                <i class="fas fa-robot"></i>
                <span>Agent Chat</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseAgentChat">
                <a href="{{ url_for('agent_chat') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-comments"></i>
                    <span>新会话</span>
                </a>
                <a href="{{ url_for('agent_chat') }}?view=history" class="nav-item ms-4 py-2">
                    <i class="fas fa-history"></i>
                    <span>会话历史</span>
                </a>
                <a href="{{ url_for('agent_settings') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-tools"></i>
                    <span>Agent设置</span>
                </a>
            </div>
            
            <div class="nav-section">设置</div>
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseSettings" aria-expanded="false">
                <i class="fas fa-user-cog"></i>
                <span>账户</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseSettings">
                <a href="{{ url_for('account_settings') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-user"></i>
                    <span>个人资料</span>
                </a>
                <a href="{{ url_for('account_settings') }}?tab=security" class="nav-item ms-4 py-2">
                    <i class="fas fa-shield-alt"></i>
                    <span>安全设置</span>
                </a>
                <a href="{{ url_for('notifications') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-bell"></i>
                    <span>通知中心</span>
                </a>
            </div>
            
            <a href="{{ url_for('notifications') }}" class="nav-item">
                <i class="fas fa-bell"></i>
                <span>通知中心</span>
            </a>
            <a href="{{ url_for('logout') }}" class="nav-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>退出登录</span>
            </a>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        {% if request.args.get('type') == 'contract' %}
        <!-- Contract Analysis View -->
        <div class="content-header">
            <div>
                <h1 class="page-title">合同分析</h1>
                <p class="text-muted">智能分析合同文档，识别关键条款，评估风险</p>
            </div>
            <div>
                <button class="btn btn-outline-primary me-2">
                    <i class="fas fa-history me-1"></i> 历史分析
                </button>
                <button class="btn btn-primary">
                    <i class="fas fa-upload me-1"></i> 上传合同
                </button>
            </div>
        </div>
        
        <div class="analysis-container">
            <div class="analysis-header">
                <h5 class="mb-3"><i class="fas fa-file-contract me-2"></i> 合同分析示例</h5>
                
                <div class="analysis-tabs">
                    <div class="analysis-tab active">合同摘要</div>
                    <div class="analysis-tab">风险评估</div>
                    <div class="analysis-tab">条款分析</div>
                    <div class="analysis-tab">合同方</div>
                    <div class="analysis-tab">时间线</div>
                </div>
            </div>
            
            <div class="analysis-body">
                <div class="analysis-results">
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-info-circle"></i> 合同摘要</h5>
                        <div class="result-card">
                            <div class="result-card-content">
                                <p>该合同为《软件开发服务协议》，由甲方（ABC科技有限公司）与乙方（XYZ软件开发有限公司）于2025年1月15日签订。合同主要内容包括软件开发服务、知识产权归属、保密条款、付款条件和违约责任等。</p>
                                <p>合同总金额为¥320,000.00，分三期支付，合同有效期为12个月，自签订之日起生效。合同包含保密条款，双方需对对方的商业机密和技术信息保密，期限为5年。</p>
                                <p>该合同还包含知识产权归属条款，明确开发成果归甲方所有，但乙方保留一定的使用权。</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-exclamation-triangle"></i> 风险评估</h5>
                        <div class="result-card">
                            <div class="result-card-title">
                                整体风险评级
                                <span class="result-card-badge badge-warning">中等风险</span>
                            </div>
                            <div class="result-card-content">
                                <div class="progress-container">
                                    <div class="progress-label">
                                        <div class="progress-label-text">风险分数</div>
                                        <div class="progress-label-value">65/100</div>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="result-card">
                                    <div class="result-card-title">
                                        主要风险点
                                    </div>
                                    <div class="result-card-content">
                                        <ul class="mb-0">
                                            <li>交付时间表缺乏明确的里程碑和可交付成果</li>
                                            <li>缺少第三方知识产权侵权的保障条款</li>
                                            <li>付款条件较为宽松，缺乏与交付质量的关联</li>
                                            <li>缺少明确的争议解决机制</li>
                                            <li>保密条款范围广泛，可能限制乙方后续业务</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="result-card">
                                    <div class="result-card-title">
                                        改进建议
                                    </div>
                                    <div class="result-card-content">
                                        <ul class="mb-0">
                                            <li>增加明确的项目里程碑和可交付成果清单</li>
                                            <li>添加知识产权担保条款</li>
                                            <li>将付款与交付里程碑和验收标准关联</li>
                                            <li>增加明确的争议解决条款，包括仲裁条款</li>
                                            <li>明确保密信息的范围和例外情况</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-list-ul"></i> 关键条款识别</h5>
                        
                        <div class="result-card">
                            <div class="result-card-title">
                                条款：服务范围与交付
                                <span class="result-card-badge badge-warning">需注意</span>
                            </div>
                            <div class="result-card-content">
                                <p><strong>原文：</strong>"乙方承诺按照甲方需求提供软件开发服务，包括但不限于需求分析、设计、开发、测试和部署。乙方应按照甲方的合理要求进行开发，并在合理时间内交付。"</p>
                                <p><strong>分析：</strong>条款缺乏明确的交付时间表和具体的交付标准，"合理时间"和"合理要求"表述模糊，可能导致对交付时间和质量标准的争议。</p>
                            </div>
                        </div>
                        
                        <div class="result-card">
                            <div class="result-card-title">
                                条款：知识产权
                                <span class="result-card-badge badge-neutral">标准条款</span>
                            </div>
                            <div class="result-card-content">
                                <p><strong>原文：</strong>"开发过程中产生的所有知识产权成果，包括但不限于源代码、设计文档、用户手册等，归甲方所有。乙方保留对通用组件和开发工具的知识产权。"</p>
                                <p><strong>分析：</strong>条款明确了知识产权归属，但对"通用组件和开发工具"的定义不够清晰，可能导致未来对哪些部分属于乙方的争议。</p>
                            </div>
                        </div>
                        
                        <div class="result-card">
                            <div class="result-card-title">
                                条款：付款条件
                                <span class="result-card-badge badge-negative">高风险</span>
                            </div>
                            <div class="result-card-content">
                                <p><strong>原文：</strong>"甲方应按照以下方式向乙方支付服务费用：首付40%（签约后7个工作日内），中期付款30%（项目进行到一半时），余款30%（项目完成后）。"</p>
                                <p><strong>分析：</strong>条款中"项目进行到一半时"表述模糊，缺乏客观验收标准。建议将付款与明确的项目里程碑和交付成果关联，并增加验收标准。</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-user-tie"></i> 合同方信息</h5>
                        
                        <div class="contract-parties">
                            <div class="party-card">
                                <div class="party-icon">
                                    <i class="fas fa-building"></i>
                                </div>
                                <div class="party-info">
                                    <div class="party-name">ABC科技有限公司</div>
                                    <div class="party-role">甲方（客户）</div>
                                </div>
                            </div>
                            
                            <div class="party-card">
                                <div class="party-icon">
                                    <i class="fas fa-laptop-code"></i>
                                </div>
                                <div class="party-info">
                                    <div class="party-name">XYZ软件开发有限公司</div>
                                    <div class="party-role">乙方（服务提供商）</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-calendar-alt"></i> 合同时间线</h5>
                        
                        <div class="contract-timeline">
                            <div class="timeline-item">
                                <div class="timeline-date">2025-01-15</div>
                                <div class="timeline-content">合同签署日期</div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-date">2025-01-22</div>
                                <div class="timeline-content">首付款截止日期（签约后7个工作日）</div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-date">2025-07-15</div>
                                <div class="timeline-content">预计中期付款时间点（估计）</div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-date">2026-01-15</div>
                                <div class="timeline-content">合同到期日（签署后12个月）</div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-date">2030-01-15</div>
                                <div class="timeline-content">保密条款期限结束（签署后5年）</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analysis-footer">
                <div>
                    <button class="btn btn-outline-secondary">
                        <i class="fas fa-print me-1"></i> 打印报告
                    </button>
                    <button class="btn btn-outline-secondary ms-2">
                        <i class="fas fa-download me-1"></i> 导出分析
                    </button>
                </div>
                <div>
                    <button class="btn btn-outline-primary">
                        <i class="fas fa-comment-alt me-1"></i> 分析建议
                    </button>
                </div>
            </div>
        </div>
        
        {% elif request.args.get('type') == 'finance' %}
        <!-- Financial Document Analysis View -->
        <div class="content-header">
            <div>
                <h1 class="page-title">财务文档分析</h1>
                <p class="text-muted">智能分析财务报表和文档，提取关键指标，进行趋势分析</p>
            </div>
            <div>
                <button class="btn btn-outline-primary me-2">
                    <i class="fas fa-history me-1"></i> 历史分析
                </button>
                <button class="btn btn-primary">
                    <i class="fas fa-upload me-1"></i> 上传文档
                </button>
            </div>
        </div>
        
        <div class="analysis-container">
            <div class="analysis-header">
                <h5 class="mb-3"><i class="fas fa-file-invoice-dollar me-2"></i> 财务报表分析示例</h5>
                
                <div class="analysis-tabs">
                    <div class="analysis-tab active">财务概览</div>
                    <div class="analysis-tab">趋势分析</div>
                    <div class="analysis-tab">比率分析</div>
                    <div class="analysis-tab">现金流</div>
                    <div class="analysis-tab">风险提示</div>
                </div>
            </div>
            
            <div class="analysis-body">
                <div class="analysis-results">
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-chart-pie"></i> 财务概览</h5>
                        
                        <div class="financial-summary">
                            <div class="financial-metric">
                                <div class="metric-value">¥ 15.6M</div>
                                <div class="metric-label">总收入</div>
                                <div class="metric-change positive">
                                    <i class="fas fa-arrow-up"></i> 12.3%
                                </div>
                            </div>
                            
                            <div class="financial-metric">
                                <div class="metric-value">¥ 2.8M</div>
                                <div class="metric-label">净利润</div>
                                <div class="metric-change positive">
                                    <i class="fas fa-arrow-up"></i> 8.5%
                                </div>
                            </div>
                            
                            <div class="financial-metric">
                                <div class="metric-value">18.2%</div>
                                <div class="metric-label">净利润率</div>
                                <div class="metric-change negative">
                                    <i class="fas fa-arrow-down"></i> 1.2%
                                </div>
                            </div>
                            
                            <div class="financial-metric">
                                <div class="metric-value">¥ 3.4M</div>
                                <div class="metric-label">运营成本</div>
                                <div class="metric-change negative">
                                    <i class="fas fa-arrow-up"></i> 5.7%
                                </div>
                            </div>
                            
                            <div class="financial-metric">
                                <div class="metric-value">¥ 8.2M</div>
                                <div class="metric-label">总资产</div>
                                <div class="metric-change positive">
                                    <i class="fas fa-arrow-up"></i> 9.8%
                                </div>
                            </div>
                            
                            <div class="financial-metric">
                                <div class="metric-value">0.42</div>
                                <div class="metric-label">负债比率</div>
                                <div class="metric-change positive">
                                    <i class="fas fa-arrow-down"></i> 3.5%
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-chart-line"></i> 收入与支出分析</h5>
                        
                        <div class="chart-container">
                            <canvas id="revenueExpenseChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-balance-scale"></i> 财务比率分析</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="result-card">
                                    <div class="result-card-title">
                                        流动性比率
                                    </div>
                                    <div class="result-card-content">
                                        <div class="progress-container">
                                            <div class="progress-label">
                                                <div class="progress-label-text">流动比率</div>
                                                <div class="progress-label-value">2.1</div>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 70%" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="progress-container">
                                            <div class="progress-label">
                                                <div class="progress-label-text">速动比率</div>
                                                <div class="progress-label-value">1.5</div>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-info" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="progress-container">
                                            <div class="progress-label">
                                                <div class="progress-label-text">现金比率</div>
                                                <div class="progress-label-value">0.8</div>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: 40%" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="result-card">
                                    <div class="result-card-title">
                                        盈利能力比率
                                    </div>
                                    <div class="result-card-content">
                                        <div class="progress-container">
                                            <div class="progress-label">
                                                <div class="progress-label-text">毛利率</div>
                                                <div class="progress-label-value">42.5%</div>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="progress-container">
                                            <div class="progress-label">
                                                <div class="progress-label-text">净利润率</div>
                                                <div class="progress-label-value">18.2%</div>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-info" role="progressbar" style="width: 55%" aria-valuenow="55" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="progress-container">
                                            <div class="progress-label">
                                                <div class="progress-label-text">ROA</div>
                                                <div class="progress-label-value">12.8%</div>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-primary" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-file-invoice"></i> 财务报表主要发现</h5>
                        
                        <div class="result-card">
                            <div class="result-card-title">
                                业务表现分析
                            </div>
                            <div class="result-card-content">
                                <p>1. <strong>收入增长强劲：</strong>总收入同比增长12.3%，达到¥15.6M，主要由于新产品线增长28.5%和国际市场扩张。</p>
                                <p>2. <strong>毛利率保持稳定：</strong>毛利率为42.5%，较上年略微下降0.8个百分点，主要受原材料成本上涨影响。</p>
                                <p>3. <strong>运营成本增加：</strong>运营成本增长5.7%，略高于通货膨胀率，主要是人力成本和营销费用增加所致。</p>
                                <p>4. <strong>资产负债管理良好：</strong>负债比率降至0.42，显示公司财务杠杆降低，财务状况更加稳健。</p>
                                <p>5. <strong>现金流略有改善：</strong>经营活动现金流增长4.2%，但仍低于收入增长率，表明应收账款管理需要改进。</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-exclamation-circle"></i> 风险与改进建议</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="result-card">
                                    <div class="result-card-title">
                                        潜在风险
                                    </div>
                                    <div class="result-card-content">
                                        <ul class="mb-0">
                                            <li>运营成本增长速度接近收入增长率，可能影响未来利润率</li>
                                            <li>现金比率（0.8）低于行业平均水平，短期流动性存在一定压力</li>
                                            <li>存货周转率下降5.2%，可能指示存货管理问题</li>
                                            <li>高度依赖单一产品线，产品结构集中风险较高</li>
                                            <li>国际市场收入波动较大，汇率风险值得关注</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="result-card">
                                    <div class="result-card-title">
                                        改进建议
                                    </div>
                                    <div class="result-card-content">
                                        <ul class="mb-0">
                                            <li>实施更严格的成本控制措施，特别是非核心业务支出</li>
                                            <li>优化应收账款管理流程，缩短收款周期，提高现金流</li>
                                            <li>改进存货管理系统，降低库存水平，提高存货周转率</li>
                                            <li>探索产品多元化策略，降低对单一产品线的依赖</li>
                                            <li>考虑采用汇率对冲策略，降低国际业务波动风险</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analysis-footer">
                <div>
                    <button class="btn btn-outline-secondary">
                        <i class="fas fa-print me-1"></i> 打印报告
                    </button>
                    <button class="btn btn-outline-secondary ms-2">
                        <i class="fas fa-download me-1"></i> 导出分析
                    </button>
                </div>
                <div>
                    <button class="btn btn-outline-primary">
                        <i class="fas fa-chart-bar me-1"></i> 深入分析
                    </button>
                </div>
            </div>
        </div>
        
        {% elif request.args.get('type') == 'medical' %}
        <!-- Medical Document Analysis View -->
        <div class="content-header">
            <div>
                <h1 class="page-title">医疗文档分析</h1>
                <p class="text-muted">智能分析医疗记录文档，提取关键医疗信息，确保隐私安全</p>
            </div>
            <div>
                <button class="btn btn-outline-primary me-2">
                    <i class="fas fa-history me-1"></i> 历史分析
                </button>
                <button class="btn btn-primary">
                    <i class="fas fa-upload me-1"></i> 上传文档
                </button>
            </div>
        </div>
        
        <div class="analysis-container">
            <div class="analysis-header">
                <h5 class="mb-3"><i class="fas fa-file-medical me-2"></i> 医疗文档分析示例</h5>
                
                <div class="analysis-tabs">
                    <div class="analysis-tab active">病历摘要</div>
                    <div class="analysis-tab">诊断信息</div>
                    <div class="analysis-tab">治疗方案</div>
                    <div class="analysis-tab">药物信息</div>
                    <div class="analysis-tab">后续建议</div>
                </div>
            </div>
            
            <div class="analysis-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i> 医疗文档分析已完成匿名化处理，所有患者身份信息已被移除或替换，以保护隐私。
                </div>
                
                <div class="analysis-results">
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-clipboard-list"></i> 病历摘要</h5>
                        
                        <div class="medical-summary">
                            <div class="medical-info-row">
                                <div class="medical-info-label">文档类型：</div>
                                <div class="medical-info-value">门诊病历</div>
                            </div>
                            <div class="medical-info-row">
                                <div class="medical-info-label">科室：</div>
                                <div class="medical-info-value">内科 - 心血管</div>
                            </div>
                            <div class="medical-info-row">
                                <div class="medical-info-label">日期：</div>
                                <div class="medical-info-value">2025年5月10日</div>
                            </div>
                            <div class="medical-info-row">
                                <div class="medical-info-label">患者基本信息：</div>
                                <div class="medical-info-value">65岁男性，有高血压病史10年，糖尿病史5年</div>
                            </div>
                        </div>
                        
                        <div class="result-card">
                            <div class="result-card-title">主诉</div>
                            <div class="result-card-content">
                                <p>患者主诉胸闷、气短3天，活动后加重，伴有轻微胸痛，无发热。</p>
                            </div>
                        </div>
                        
                        <div class="result-card">
                            <div class="result-card-title">现病史</div>
                            <div class="result-card-content">
                                <p>患者3天前开始出现胸闷、气短症状，活动后症状加重，休息后可缓解。昨日出现轻微胸痛，位于胸骨后，持续约5分钟后自行缓解。患者有高血压病史10年，一直服用缬沙坦控制，血压控制在140-150/85-90mmHg；有2型糖尿病史5年，服用二甲双胍控制，空腹血糖控制在7-8mmol/L。</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-stethoscope"></i> 诊断信息</h5>
                        
                        <div class="diagnosis-card">
                            <h6>主要诊断</h6>
                            <p>不稳定心绞痛（UA）</p>
                            <p><strong>ICD-10代码：</strong> I20.0</p>
                            <p><strong>置信度：</strong> 92%</p>
                            <p><strong>依据：</strong> 基于患者的症状（胸闷、气短、活动后加重的轻微胸痛），结合ECG结果（前壁导联ST段轻度压低）和患者的心血管疾病风险因素（高血压、糖尿病、年龄）。</p>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="diagnosis-card">
                                    <h6>次要诊断 1</h6>
                                    <p>原发性高血压</p>
                                    <p><strong>ICD-10代码：</strong> I10</p>
                                    <p><strong>置信度：</strong> 98%</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="diagnosis-card">
                                    <h6>次要诊断 2</h6>
                                    <p>2型糖尿病</p>
                                    <p><strong>ICD-10代码：</strong> E11.9</p>
                                    <p><strong>置信度：</strong> 98%</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-pills"></i> 药物处方</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="prescription-item">
                                    <div class="prescription-icon">
                                        <i class="fas fa-tablets"></i>
                                    </div>
                                    <div class="prescription-info">
                                        <div class="prescription-name">阿司匹林</div>
                                        <div class="prescription-dosage">100mg，每日一次，餐后服用</div>
                                    </div>
                                </div>
                                
                                <div class="prescription-item">
                                    <div class="prescription-icon">
                                        <i class="fas fa-tablets"></i>
                                    </div>
                                    <div class="prescription-info">
                                        <div class="prescription-name">氯吡格雷</div>
                                        <div class="prescription-dosage">75mg，每日一次，餐后服用</div>
                                    </div>
                                </div>
                                
                                <div class="prescription-item">
                                    <div class="prescription-icon">
                                        <i class="fas fa-capsules"></i>
                                    </div>
                                    <div class="prescription-info">
                                        <div class="prescription-name">硝酸甘油</div>
                                        <div class="prescription-dosage">0.5mg，舌下含服，发作时使用</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="prescription-item">
                                    <div class="prescription-icon">
                                        <i class="fas fa-tablets"></i>
                                    </div>
                                    <div class="prescription-info">
                                        <div class="prescription-name">缬沙坦</div>
                                        <div class="prescription-dosage">80mg，每日一次，继续使用</div>
                                    </div>
                                </div>
                                
                                <div class="prescription-item">
                                    <div class="prescription-icon">
                                        <i class="fas fa-pills"></i>
                                    </div>
                                    <div class="prescription-info">
                                        <div class="prescription-name">二甲双胍</div>
                                        <div class="prescription-dosage">500mg，每日两次，餐后服用，继续使用</div>
                                    </div>
                                </div>
                                
                                <div class="prescription-item">
                                    <div class="prescription-icon">
                                        <i class="fas fa-tablets"></i>
                                    </div>
                                    <div class="prescription-info">
                                        <div class="prescription-name">阿托伐他汀</div>
                                        <div class="prescription-dosage">20mg，每晚一次</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-notes-medical"></i> 检查结果分析</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="result-card">
                                    <div class="result-card-title">心电图 (ECG)</div>
                                    <div class="result-card-content">
                                        <p>窦性心律，心率78次/分钟。前壁导联（V2-V4）ST段轻度压低0.5-1mm。</p>
                                        <p><strong>分析：</strong> ECG变化提示前壁心肌缺血可能，符合不稳定心绞痛的表现。</p>
                                    </div>
                                </div>
                                
                                <div class="result-card">
                                    <div class="result-card-title">心肌标志物</div>
                                    <div class="result-card-content">
                                        <p>肌钙蛋白I (cTnI): 0.04 ng/mL (正常: &lt;0.04 ng/mL)</p>
                                        <p>肌酸激酶同工酶 (CK-MB): 3.2 ng/mL (正常: &lt;5 ng/mL)</p>
                                        <p><strong>分析：</strong> 心肌标志物在正常范围或轻微升高，不支持急性心肌梗死的诊断，与不稳定心绞痛相符。</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="result-card">
                                    <div class="result-card-title">血脂检查</div>
                                    <div class="result-card-content">
                                        <p>总胆固醇: 5.8 mmol/L (理想: &lt;5.2 mmol/L)</p>
                                        <p>低密度脂蛋白 (LDL): 3.6 mmol/L (理想: &lt;3.4 mmol/L)</p>
                                        <p>高密度脂蛋白 (HDL): 0.9 mmol/L (理想: &gt;1.0 mmol/L)</p>
                                        <p>甘油三酯: 2.1 mmol/L (理想: &lt;1.7 mmol/L)</p>
                                        <p><strong>分析：</strong> 血脂异常，表现为高胆固醇血症和低HDL血症，增加心血管疾病风险。</p>
                                    </div>
                                </div>
                                
                                <div class="result-card">
                                    <div class="result-card-title">血糖检查</div>
                                    <div class="result-card-content">
                                        <p>空腹血糖: 7.8 mmol/L (正常: 3.9-6.1 mmol/L)</p>
                                        <p>糖化血红蛋白 (HbA1c): 7.2% (理想: &lt;7.0%)</p>
                                        <p><strong>分析：</strong> 血糖控制不佳，需要调整糖尿病治疗方案。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-clipboard-check"></i> 治疗建议</h5>
                        
                        <div class="result-card">
                            <div class="result-card-content">
                                <ol>
                                    <li><strong>药物治疗：</strong> 按处方服用抗血小板药物（阿司匹林、氯吡格雷）、降脂药物（阿托伐他汀）及抗高血压、降糖药物。</li>
                                    <li><strong>进一步检查：</strong> 建议安排冠状动脉造影，评估冠状动脉病变情况，确定是否需要介入治疗。</li>
                                    <li><strong>生活方式调整：</strong> 建议低盐低脂饮食，适当增加体力活动，控制体重，戒烟戒酒。</li>
                                    <li><strong>心脏康复：</strong> 建议参加心脏康复项目，包括运动训练、健康教育和心理支持。</li>
                                    <li><strong>复诊安排：</strong> 一周后门诊复诊，评估症状和治疗效果。</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analysis-footer">
                <div>
                    <button class="btn btn-outline-secondary">
                        <i class="fas fa-print me-1"></i> 打印报告
                    </button>
                    <button class="btn btn-outline-secondary ms-2">
                        <i class="fas fa-download me-1"></i> 导出分析
                    </button>
                </div>
                <div>
                    <button class="btn btn-outline-primary">
                        <i class="fas fa-user-md me-1"></i> 专家意见
                    </button>
                </div>
            </div>
        </div>
        
        {% else %}
        <!-- General Document Analysis View (default) -->
        <div class="content-header">
            <div>
                <h1 class="page-title">通用文档分析</h1>
                <p class="text-muted">智能分析任何类型的文档，提取关键信息，生成摘要，识别实体和主题</p>
            </div>
            <div>
                <button class="btn btn-outline-primary me-2">
                    <i class="fas fa-history me-1"></i> 历史分析
                </button>
                <button class="btn btn-primary">
                    <i class="fas fa-upload me-1"></i> 上传文档
                </button>
            </div>
        </div>
        
        <div class="analysis-container">
            <div class="analysis-header">
                <h5 class="mb-3"><i class="fas fa-file-alt me-2"></i> 文档分析</h5>
                
                <div class="analysis-tabs">
                    <div class="analysis-tab active">摘要</div>
                    <div class="analysis-tab">实体识别</div>
                    <div class="analysis-tab">关键词</div>
                    <div class="analysis-tab">情感分析</div>
                    <div class="analysis-tab">主题分类</div>
                </div>
            </div>
            
            <div class="analysis-body">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <h3 class="upload-text">拖放文档到此处</h3>
                    <p class="upload-hint">支持 PDF、DOCX、TXT 等多种格式</p>
                    <button class="btn btn-primary">
                        <i class="fas fa-folder-open me-2"></i> 选择文件
                    </button>
                    <input type="file" id="fileInput" style="display: none;">
                </div>
                
                <div class="ai-chat-container">
                    <div class="ai-chat-messages">
                        <div class="message message-ai">
                            <p>您好！我是您的AI文档分析助手。我可以帮您分析文档内容，提取关键信息，生成摘要，识别实体和主题等。请上传一个文档，或者告诉我您想了解什么。</p>
                            <div class="message-time">14:30</div>
                        </div>
                        
                        <div class="message message-user">
                            <p>我想分析一份关于可持续发展的研究报告，它有哪些分析维度？</p>
                            <div class="message-time">14:31</div>
                        </div>
                        
                        <div class="message message-ai">
                            <p>分析可持续发展研究报告时，我可以从以下维度进行分析：</p>
                            <ol>
                                <li><strong>文档摘要：</strong>提取报告的核心观点、主要发现和结论。</li>
                                <li><strong>关键实体识别：</strong>识别报告中提到的组织、人物、地点、项目等。</li>
                                <li><strong>可持续发展目标(SDGs)映射：</strong>将内容与联合国17个可持续发展目标关联。</li>
                                <li><strong>ESG因素分析：</strong>从环境(Environmental)、社会(Social)和治理(Governance)三个维度分析内容。</li>
                                <li><strong>关键指标提取：</strong>提取报告中的重要数据指标、统计数字和趋势。</li>
                                <li><strong>政策建议提取：</strong>识别报告中的政策和行动建议。</li>
                                <li><strong>风险与机遇分析：</strong>识别报告中提到的风险因素和机遇。</li>
                                <li><strong>语言情感分析：</strong>分析报告的语调和情感倾向。</li>
                                <li><strong>引用和来源分析：</strong>分析报告引用的信息来源和权威性。</li>
                            </ol>
                            <p>如果您上传具体的报告，我可以为您提供更详细的分析。您想关注上述哪些方面？</p>
                            <div class="message-time">14:33</div>
                        </div>
                    </div>
                    
                    <div class="ai-chat-input">
                        <input type="text" placeholder="输入您的问题或分析要求..." class="form-control">
                        <button class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                
                <div class="analysis-results" style="display: none;">
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-file-alt"></i> 文档摘要</h5>
                        <div class="result-card">
                            <div class="result-card-content">
                                <p>该文档是一份关于全球气候变化影响的综合研究报告，发布于2025年4月，共56页。报告分析了过去十年全球气温变化趋势，并预测了未来可能的气候情景及其对生态系统、农业、水资源和人类健康的影响。</p>
                                <p>主要发现包括：全球平均气温持续上升，过去五年是有记录以来最热的五年；极端天气事件（如热浪、干旱、洪水）发生频率增加；海平面上升速率加快，对沿海地区造成威胁；生物多样性减少，多种物种面临灭绝风险。</p>
                                <p>报告强调需要采取紧急行动减少温室气体排放，并建议各国加强气候适应性措施，特别是在脆弱地区。报告还论述了可再生能源发展、碳中和政策以及国际合作在应对气候变化中的重要性。</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-tags"></i> 关键主题</h5>
                        <div class="keyword-cloud">
                            <span class="keyword keyword-size-5">气候变化</span>
                            <span class="keyword keyword-size-4">全球变暖</span>
                            <span class="keyword keyword-size-4">温室气体排放</span>
                            <span class="keyword keyword-size-3">可再生能源</span>
                            <span class="keyword keyword-size-3">生态系统</span>
                            <span class="keyword keyword-size-3">极端天气</span>
                            <span class="keyword keyword-size-2">海平面上升</span>
                            <span class="keyword keyword-size-2">碳中和</span>
                            <span class="keyword keyword-size-2">气候适应</span>
                            <span class="keyword keyword-size-2">生物多样性</span>
                            <span class="keyword keyword-size-1">水资源</span>
                            <span class="keyword keyword-size-1">农业影响</span>
                            <span class="keyword keyword-size-1">健康风险</span>
                            <span class="keyword keyword-size-1">国际合作</span>
                            <span class="keyword keyword-size-1">政策建议</span>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-tasks"></i> 主要观点与发现</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="result-card">
                                    <div class="result-card-title">
                                        现状评估
                                        <span class="result-card-badge badge-negative">高度紧迫</span>
                                    </div>
                                    <div class="result-card-content">
                                        <ul>
                                            <li>全球平均气温比工业化前水平上升了1.1°C</li>
                                            <li>北极地区变暖速度是全球平均水平的两倍</li>
                                            <li>2020-2025年为有记录以来最热的五年</li>
                                            <li>极端天气事件频率增加了约40%</li>
                                            <li>全球冰川体积减少了近20%</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="result-card">
                                    <div class="result-card-title">
                                        未来预测
                                        <span class="result-card-badge badge-warning">需警惕</span>
                                    </div>
                                    <div class="result-card-content">
                                        <ul>
                                            <li>如不采取行动，本世纪末全球温度可能上升2.7-3.1°C</li>
                                            <li>海平面预计到2100年上升0.5-1.0米</li>
                                            <li>20-30%的物种面临灭绝风险</li>
                                            <li>南亚和非洲将面临更严重的粮食安全问题</li>
                                            <li>沿海城市洪水风险增加，影响超过2亿人口</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-id-card"></i> 实体识别</h5>
                        
                        <div class="entity-list">
                            <div class="entity-item">
                                <div class="entity-type entity-type-org">组织</div>
                                <div class="entity-text">联合国气候变化框架公约 (UNFCCC)</div>
                            </div>
                            
                            <div class="entity-item">
                                <div class="entity-type entity-type-org">组织</div>
                                <div class="entity-text">政府间气候变化专门委员会 (IPCC)</div>
                            </div>
                            
                            <div class="entity-item">
                                <div class="entity-type entity-type-person">人物</div>
                                <div class="entity-text">安东尼奥·古特雷斯 (联合国秘书长)</div>
                            </div>
                            
                            <div class="entity-item">
                                <div class="entity-type entity-type-org">组织</div>
                                <div class="entity-text">世界气象组织 (WMO)</div>
                            </div>
                            
                            <div class="entity-item">
                                <div class="entity-type entity-type-location">地点</div>
                                <div class="entity-text">南极洲</div>
                            </div>
                            
                            <div class="entity-item">
                                <div class="entity-type entity-type-location">地点</div>
                                <div class="entity-text">巴黎</div>
                            </div>
                            
                            <div class="entity-item">
                                <div class="entity-type entity-type-date">日期</div>
                                <div class="entity-text">2015年12月</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h5 class="result-section-title"><i class="fas fa-chart-pie"></i> 情感分析</h5>
                        
                        <div class="sentiment-chart">
                            <div class="sentiment-value">-0.2</div>
                            <div class="sentiment-meter">
                                <div class="sentiment-marker" style="left: 40%"></div>
                            </div>
                            <div class="sentiment-value">+1.0</div>
                        </div>
                        
                        <div class="result-card">
                            <div class="result-card-title">情感分析结果</div>
                            <div class="result-card-content">
                                <p>文档整体情感倾向略微负面 (得分: -0.2)，主要是由于讨论气候变化带来的各种风险和威胁。</p>
                                <p>报告前半部分（现状和影响分析）情感较为负面 (得分: -0.45)，讨论了多种负面影响和风险。</p>
                                <p>报告后半部分（解决方案和行动建议）情感较为积极 (得分: +0.25)，突出了应对气候变化的机遇和可能的积极成果。</p>
                                <p>最具负面情感的章节是"极端天气事件影响"章节 (得分: -0.7)。最具正面情感的章节是"可再生能源发展"章节 (得分: +0.6)。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analysis-footer">
                <div>
                    <button class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-cog me-1"></i> 分析选项
                    </button>
                    <div class="btn-group ms-2">
                        <button class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-file-pdf me-1"></i> PDF
                        </button>
                        <button class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-file-word me-1"></i> DOCX
                        </button>
                        <button class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-file-csv me-1"></i> CSV
                        </button>
                    </div>
                </div>
                <div>
                    <button class="btn btn-primary" id="startAnalysisBtn">
                        <i class="fas fa-play me-1"></i> 开始分析示例
                    </button>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Scripts for Interactive Features -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Upload area functionality
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        
        if (uploadArea && fileInput) {
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                uploadArea.classList.add('active');
            }
            
            function unhighlight() {
                uploadArea.classList.remove('active');
            }
        }
        
        // AI Chat input functionality
        const chatInput = document.querySelector('.ai-chat-input input');
        const chatSendButton = document.querySelector('.ai-chat-input button');
        const chatMessages = document.querySelector('.ai-chat-messages');
        
        if (chatInput && chatSendButton && chatMessages) {
            chatSendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            function sendMessage() {
                const message = chatInput.value.trim();
                if (message) {
                    // Add user message
                    const userMessageElement = document.createElement('div');
                    userMessageElement.className = 'message message-user';
                    userMessageElement.innerHTML = `
                        <p>${message}</p>
                        <div class="message-time">${getCurrentTime()}</div>
                    `;
                    chatMessages.appendChild(userMessageElement);
                    
                    // Clear input
                    chatInput.value = '';
                    
                    // Scroll to bottom
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // In a real app, you would send the message to a backend and get a response
                    // For this example, we'll just simulate a response after a delay
                    setTimeout(function() {
                        const aiMessageElement = document.createElement('div');
                        aiMessageElement.className = 'message message-ai';
                        aiMessageElement.innerHTML = `
                            <p>感谢您的问题！我需要更多的信息或具体的文档才能提供详细分析。您可以上传文档或提出更具体的问题，我会尽力帮助您。</p>
                            <div class="message-time">${getCurrentTime()}</div>
                        `;
                        chatMessages.appendChild(aiMessageElement);
                        
                        // Scroll to bottom
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 1000);
                }
            }
            
            function getCurrentTime() {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                return `${hours}:${minutes}`;
            }
        }
        
        // Start Analysis Button for General Analysis
        const startAnalysisBtn = document.getElementById('startAnalysisBtn');
        const analysisResults = document.querySelector('.analysis-results');
        const uploadAreaDiv = document.querySelector('.upload-area');
        const aiChatContainer = document.querySelector('.ai-chat-container');
        
        if (startAnalysisBtn && analysisResults && uploadAreaDiv && aiChatContainer) {
            startAnalysisBtn.addEventListener('click', function() {
                // Hide upload area and chat
                uploadAreaDiv.style.display = 'none';
                aiChatContainer.style.display = 'none';
                
                // Show analysis results
                analysisResults.style.display = 'block';
                
                // Change button text
                startAnalysisBtn.innerHTML = '<i class="fas fa-redo me-1"></i> 重新分析';
            });
        }
        
        // Financial Chart for Finance Analysis
        const revenueExpenseChartCanvas = document.getElementById('revenueExpenseChart');
        
        if (revenueExpenseChartCanvas) {
            const ctx = revenueExpenseChartCanvas.getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024', 'Q1 2025'],
                    datasets: [
                        {
                            label: '收入',
                            data: [3.2, 3.8, 4.1, 4.5, 3.6],
                            backgroundColor: 'rgba(74, 108, 247, 0.1)',
                            borderColor: 'rgba(74, 108, 247, 1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '支出',
                            data: [2.4, 2.7, 2.9, 3.1, 2.6],
                            backgroundColor: 'rgba(253, 126, 20, 0.1)',
                            borderColor: 'rgba(253, 126, 20, 1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '百万元 (¥)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: '季度收入与支出趋势'
                        }
                    }
                }
            });
        }
        
        // Tabs functionality
        const analysisTabs = document.querySelectorAll('.analysis-tab');
        
        if (analysisTabs.length > 0) {
            analysisTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    analysisTabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // In a real app, you would show/hide tab content here
                    console.log(`Switched to tab: ${this.textContent}`);
                });
            });
        }
    });
</script>
{% endblock %}