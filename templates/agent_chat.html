{% extends "base.html" %}

{% block title %}Agent Chat - iDOC{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-layout">
    <!-- 左侧导航栏 -->
    <div class="sidebar">
        <div class="sidebar-brand">
            <a href="{{ url_for('dashboard') }}">
                <div class="sidebar-brand-icon">
                    <img src="{{ url_for('static', filename='img/logo-icon.svg') }}" alt="Logo Icon" onerror="this.src='{{ url_for('static', filename='img/default-logo.png') }}'">
                </div>
                <div class="sidebar-brand-text">
                    <img src="{{ url_for('static', filename='img/logo-text.svg') }}" alt="Logo Text" onerror="this.src='{{ url_for('static', filename='img/default-logo-text.png') }}'">
                    <span>iDOC</span>
                </div>
            </a>
        </div>
        
        <!-- 导航菜单 -->
        <div class="sidebar-nav">
            <a href="{{ url_for('dashboard') }}" class="nav-item">
                <i class="fas fa-tachometer-alt"></i>
                <span>仪表板</span>
            </a>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseKnowledgeBase" aria-expanded="false">
                <i class="fas fa-book"></i>
                <span>企业知识库</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseKnowledgeBase">
                <a href="{{ url_for('knowledge_base') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-folder-open"></i>
                    <span>所有知识库</span>
                </a>
                <a href="{{ url_for('knowledge_base') }}?action=import" class="nav-item ms-4 py-2">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>导入知识</span>
                </a>
                <a href="{{ url_for('knowledge_base') }}?action=settings" class="nav-item ms-4 py-2">
                    <i class="fas fa-cogs"></i>
                    <span>知识库设置</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseDocuments" aria-expanded="false">
                <i class="fas fa-file-alt"></i>
                <span>文档管理</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseDocuments">
                <a href="{{ url_for('documents_list') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-list"></i>
                    <span>所有文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}?action=upload" class="nav-item ms-4 py-2">
                    <i class="fas fa-upload"></i>
                    <span>上传文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}?action=recent" class="nav-item ms-4 py-2">
                    <i class="fas fa-clock"></i>
                    <span>最近文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}?action=starred" class="nav-item ms-4 py-2">
                    <i class="fas fa-star"></i>
                    <span>星标文档</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseWorkflow" aria-expanded="false">
                <i class="fas fa-project-diagram"></i>
                <span>工作流管理</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseWorkflow">
                <a href="{{ url_for('workflow_create') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-plus"></i>
                    <span>创建工作流</span>
                </a>
                <a href="{{ url_for('workflow_create') }}?action=templates" class="nav-item ms-4 py-2">
                    <i class="fas fa-clipboard-list"></i>
                    <span>工作流模板</span>
                </a>
                <a href="{{ url_for('workflow_create') }}?action=running" class="nav-item ms-4 py-2">
                    <i class="fas fa-play-circle"></i>
                    <span>运行中工作流</span>
                </a>
                <a href="{{ url_for('workflow_create') }}?action=history" class="nav-item ms-4 py-2">
                    <i class="fas fa-history"></i>
                    <span>历史工作流</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseAnalysis" aria-expanded="false">
                <i class="fas fa-chart-bar"></i>
                <span>AI分析</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseAnalysis">
                <a href="{{ url_for('ai_analysis') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-search"></i>
                    <span>内容分析</span>
                </a>
                <a href="{{ url_for('ai_analysis') }}?action=compare" class="nav-item ms-4 py-2">
                    <i class="fas fa-not-equal"></i>
                    <span>文档对比</span>
                </a>
                <a href="{{ url_for('ai_analysis') }}?action=extract" class="nav-item ms-4 py-2">
                    <i class="fas fa-filter"></i>
                    <span>信息提取</span>
                </a>
                <a href="{{ url_for('ai_analysis') }}?action=summary" class="nav-item ms-4 py-2">
                    <i class="fas fa-compress-alt"></i>
                    <span>文档摘要</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseAgent" aria-expanded="true">
                <i class="fas fa-robot"></i>
                <span>Agent Chat</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse show" id="collapseAgent">
                <a href="{{ url_for('agent_chat') }}" class="nav-item ms-4 py-2 active">
                    <i class="fas fa-comments"></i>
                    <span>新会话</span>
                </a>
                <a href="{{ url_for('agent_chat_history') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-history"></i>
                    <span>聊天历史</span>
                </a>
                <a href="{{ url_for('multi_agent_workshop') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-users-cog"></i>
                    <span>多Agent协作</span>
                </a>
                <a href="{{ url_for('agent_settings') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-sliders-h"></i>
                    <span>Agent设置</span>
                </a>
            </div>
            
            <div class="nav-section">用户</div>
            
            <a href="{{ url_for('account_settings') }}" class="nav-item">
                <i class="fas fa-user-cog"></i>
                <span>账户设置</span>
            </a>
            
            <a href="{{ url_for('notifications') }}" class="nav-item">
                <i class="fas fa-bell"></i>
                <span>通知</span>
                <span class="badge rounded-pill bg-primary ms-auto">3</span>
            </a>
            
            <a href="{{ url_for('logout') }}" class="nav-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>退出登录</span>
            </a>
        </div>
    </div>
    
    <!-- 主内容区域 -->
    <div class="main-content">
        <!-- 聊天界面 -->
        <div class="chat-container">
            <!-- 聊天侧边栏 -->
            <div class="chat-sidebar">
                <div class="chat-sidebar-header">
                    <h5 class="chat-sidebar-title">聊天历史</h5>
                    <button class="btn btn-sm btn-primary" title="新建会话">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="chat-sidebar-search">
                    <input type="text" placeholder="搜索聊天..." class="form-control form-control-sm">
                </div>
                
                <div class="history-filters">
                    <div class="history-filter active">全部</div>
                    <div class="history-filter">合同分析</div>
                    <div class="history-filter">财务分析</div>
                    <div class="history-filter">风险评估</div>
                </div>
                
                <div class="chat-list">
                    <div class="chat-item active">
                        <div class="chat-item-avatar">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <div class="chat-item-content">
                            <div class="chat-item-name">采购合同分析</div>
                            <div class="chat-item-preview">分析这份合同的主要条款...</div>
                        </div>
                        <div class="chat-item-meta">
                            刚刚
                        </div>
                    </div>
                    
                    <div class="chat-item">
                        <div class="chat-item-avatar">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="chat-item-content">
                            <div class="chat-item-name">Q3财务报表分析</div>
                            <div class="chat-item-preview">请分析一下这份财务报表的主要...</div>
                        </div>
                        <div class="chat-item-meta">
                            2小时前
                        </div>
                    </div>
                    
                    <div class="chat-item">
                        <div class="chat-item-avatar">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <div class="chat-item-content">
                            <div class="chat-item-name">项目风险评估</div>
                            <div class="chat-item-preview">评估一下这个项目的主要风险点...</div>
                        </div>
                        <div class="chat-item-meta">
                            昨天
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 聊天主界面 -->
            <div class="chat-main">
                <div class="chat-header">
                    <div class="chat-header-info">
                        <div class="chat-header-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <div class="chat-header-name">iDOC 智能助手</div>
                            <div class="chat-header-status">在线</div>
                        </div>
                    </div>
                    
                    <div class="chat-header-actions">
                        <button class="btn btn-sm btn-outline-secondary" title="导出聊天记录">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" title="设置">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
                
                <div class="chat-body">
                    <!-- 聊天消息将在这里动态添加 -->
                </div>
                
                <div class="chat-footer">
                    <!-- 智能建议区域 -->
                    <div class="smart-suggestions-wrapper" id="suggestions-container" style="display: none;">
                        <div class="smart-suggestions-title">智能建议</div>
                        <div class="smart-suggestions-list">
                            <button class="suggestion-pill">分析这份合同的主要条款</button>
                            <button class="suggestion-pill">提供文档摘要</button>
                            <button class="suggestion-pill">比较两份文档的差异</button>
                            <button class="suggestion-pill">提取关键数据</button>
                            <button class="suggestion-pill">检查文档合规性</button>
                        </div>
                    </div>
                    
                    <!-- 上下文参考区域 -->
                    <div class="context-bar" id="context-bar" style="display: none;">
                        <div class="context-title">上下文参考</div>
                        <div class="context-documents">
                            <div class="context-document">
                                <i class="fas fa-file-contract"></i>
                                <span>采购合同.docx</span>
                            </div>
                            <div class="context-document">
                                <i class="fas fa-file-pdf"></i>
                                <span>财务报表.pdf</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 消息输入区域 -->
                    <div class="message-input-container">
                        <div class="input-wrapper">
                            <textarea class="message-input" placeholder="输入您的问题或要求..." rows="1"></textarea>
                            <div class="autocomplete-container" id="autocomplete-container"></div>
                        </div>
                        <div class="message-actions">
                            <button class="message-action-btn" id="context-toggle-btn" title="显示上下文">
                                <i class="fas fa-lightbulb"></i>
                            </button>
                            <button class="message-action-btn" id="suggestion-toggle-btn" title="显示建议">
                                <i class="fas fa-magic"></i>
                            </button>
                            <button class="message-options-btn" title="附加文件">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button class="message-send-btn" title="发送消息">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/new_chat.js') }}"></script>
{% endblock %}