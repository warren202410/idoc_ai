{% extends "base.html" %}

{% block title %}Dashboard - iDOC{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: #f5f8fa;
        min-height: 100vh;
        font-family: 'Inter', sans-serif;
    }
    
    .dashboard-layout {
        display: flex;
        min-height: calc(100vh - 1rem);
    }
    
    .sidebar {
        width: 250px;
        background-color: #fff;
        border-right: 1px solid #e5e9f2;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        position: fixed;
        height: 100vh;
        z-index: 1000;
    }
    
    .sidebar-brand {
        padding: 1.5rem;
        border-bottom: 1px solid #e5e9f2;
    }
    
    .sidebar-brand-text {
        font-size: 1.5rem;
        font-weight: 600;
    }
    
    .sidebar-user {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #e5e9f2;
    }
    
    .sidebar-nav {
        padding: 1rem 0;
    }
    
    .nav-section {
        padding: 0.5rem 1.5rem;
        font-size: 0.8rem;
        text-transform: uppercase;
        color: #6c757d;
        font-weight: 600;
    }
    
    .nav-item {
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        color: #495057;
        text-decoration: none;
        transition: all 0.2s;
        cursor: pointer;
    }
    
    .nav-item:hover, .nav-item.active {
        color: #4A6CF7;
        background-color: rgba(74, 108, 247, 0.05);
    }
    
    .nav-item i {
        width: 20px;
        margin-right: 0.75rem;
    }
    
    .sidebar-nav .collapse {
        background-color: rgba(0, 0, 0, 0.02);
    }
    
    .sidebar-nav .collapse .nav-item {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        font-size: 0.9rem;
    }
    
    .nav-item[data-bs-toggle="collapse"] {
        position: relative;
    }
    
    .nav-item[data-bs-toggle="collapse"] .fa-chevron-down {
        font-size: 0.75rem;
        transition: transform 0.3s ease;
    }
    
    .nav-item[data-bs-toggle="collapse"][aria-expanded="true"] .fa-chevron-down {
        transform: rotate(180deg);
    }
    
    .main-content {
        flex: 1;
        margin-left: 250px;
        padding: 2rem;
    }
    
    .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }
    
    .page-title {
        margin: 0;
        font-weight: 600;
    }
    
    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #4A6CF7;
        color: white;
        font-weight: 600;
    }
    
    .document-card {
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        padding: 1.5rem;
        height: 100%;
        border: 1px solid #e5e9f2;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .document-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem;
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
    }
    
    .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background-color: #fff;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #4A6CF7;
        transition: transform 0.2s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 600;
        color: #212529;
    }
    
    .stat-label {
        color: #6c757d;
        font-size: 0.875rem;
    }
    
    .badge-brand {
        background-color: #4A6CF7;
    }
    
    /* 悬浮AI助手样式 */
    .ai-assistant-fab {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background-color: #4A6CF7;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        z-index: 1050;
        transition: all 0.3s ease;
    }
    
    .ai-assistant-fab:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
    }
    
    .ai-assistant-panel {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 380px;
        height: 500px;
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        z-index: 1051;
        overflow: hidden;
        display: none; /* 默认隐藏 */
        flex-direction: column;
        transition: all 0.3s ease;
    }
    
    .ai-assistant-header {
        padding: 1rem;
        background-color: #4A6CF7;
        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .ai-assistant-body {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background-color: #f8f9fa;
    }
    
    .ai-assistant-footer {
        padding: 1rem;
        border-top: 1px solid #e9ecef;
        background-color: white;
    }
    
    .chat-message {
        margin-bottom: 1rem;
    }
    
    .chat-message-bot {
        display: flex;
        margin-bottom: 1rem;
    }
    
    .chat-message-user {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 1rem;
    }
    
    .chat-bubble-bot {
        background-color: white;
        padding: 0.75rem 1rem;
        border-radius: 18px;
        border-top-left-radius: 4px;
        max-width: 80%;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    .chat-bubble-user {
        background-color: #4A6CF7;
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 18px;
        border-top-right-radius: 4px;
        max-width: 80%;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    /* 功能区模块样式 */
    .feature-section {
        margin-bottom: 2rem;
    }
    
    .feature-section-header {
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .feature-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
    }
    
    .feature-title-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        background-color: rgba(74, 108, 247, 0.1);
        color: #4A6CF7;
        margin-right: 0.75rem;
    }
    
    .dashboard-card {
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        height: 100%;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }
    
    .dashboard-card-header {
        padding: 1.25rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .dashboard-card-body {
        padding: 1.25rem;
    }
    
    .dashboard-card-footer {
        padding: 1rem 1.25rem;
        border-top: 1px solid rgba(0, 0, 0, 0.05);
        background-color: rgba(0, 0, 0, 0.01);
    }
    
    .quick-action-card {
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        padding: 1.25rem;
        display: flex;
        align-items: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: pointer;
        height: 100%;
    }
    
    .quick-action-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .quick-action-icon {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        background-color: rgba(74, 108, 247, 0.1);
        color: #4A6CF7;
        margin-right: 1rem;
    }
    
    .quick-action-content {
        flex: 1;
    }
    
    .quick-action-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
        font-size: 1rem;
    }
    
    .quick-action-desc {
        color: #6c757d;
        font-size: 0.875rem;
        margin: 0;
    }
    
    /* 移动端适配 */
    @media (max-width: 992px) {
        .sidebar {
            width: 64px;
            overflow: hidden;
        }
        
        .sidebar-brand-text, .sidebar-brand span, .sidebar-user, .nav-section {
            display: none;
        }
        
        .sidebar-nav {
            padding: 1rem 0;
        }
        
        .nav-item {
            padding: 0.75rem;
            justify-content: center;
        }
        
        .nav-item i {
            margin-right: 0;
        }
        
        .nav-item span {
            display: none;
        }
        
        .main-content {
            margin-left: 64px;
        }
        
        .ai-assistant-panel {
            width: 320px;
            height: 450px;
        }
    }
    
    @media (max-width: 768px) {
        .ai-assistant-panel {
            width: 300px;
            height: 400px;
            bottom: 1rem;
            right: 1rem;
        }
        
        .ai-assistant-fab {
            bottom: 1rem;
            right: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-layout">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-brand">
            <a href="{{ url_for('dashboard') }}" class="d-flex align-items-center text-decoration-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-file-earmark-text text-primary" viewBox="0 0 16 16">
                    <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5"/>
                    <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"/>
                </svg>
                <span class="sidebar-brand-text ms-2"><span class="text-primary">i</span>DOC</span>
            </a>
        </div>
        
        <div class="sidebar-user">
            <div class="d-flex align-items-center">
                <div class="flex-shrink-0">
                    {% if current_user.profile_image_url %}
                    <img src="{{ current_user.profile_image_url }}" alt="Profile" class="rounded-circle" width="40" height="40" style="object-fit: cover;">
                    {% else %}
                    <div class="user-avatar">
                        {{ current_user.first_name[0] }}{{ current_user.last_name[0] if current_user.last_name else '' }}
                    </div>
                    {% endif %}
                </div>
                <div class="flex-grow-1 ms-3">
                    <h6 class="mb-0">{{ current_user.first_name }} {{ current_user.last_name }}</h6>
                    <small class="text-muted">{{ current_user.email }}</small>
                </div>
            </div>
        </div>
        
        <div class="sidebar-nav">
            <div class="nav-section">主要</div>
            <a href="{{ url_for('dashboard') }}" class="nav-item active">
                <i class="fas fa-tachometer-alt"></i>
                <span>仪表板</span>
            </a>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseKnowledgeBase" aria-expanded="false">
                <i class="fas fa-book"></i>
                <span>企业知识库</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseKnowledgeBase">
                <a href="{{ url_for('knowledge_base') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-folder-open"></i>
                    <span>所有知识库</span>
                </a>
                <a href="{{ url_for('knowledge_base') }}?action=import" class="nav-item ms-4 py-2">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>导入知识</span>
                </a>
                <a href="{{ url_for('knowledge_base') }}?action=settings" class="nav-item ms-4 py-2">
                    <i class="fas fa-cogs"></i>
                    <span>知识库设置</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseDocuments" aria-expanded="false">
                <i class="fas fa-file-alt"></i>
                <span>文档管理</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseDocuments">
                <a href="{{ url_for('documents_list') }}?action=upload" class="nav-item ms-4 py-2">
                    <i class="fas fa-file-upload"></i>
                    <span>上传文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-folder"></i>
                    <span>我的文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}?filter=shared" class="nav-item ms-4 py-2">
                    <i class="fas fa-share-alt"></i>
                    <span>共享文档</span>
                </a>
                <a href="{{ url_for('documents_list') }}?filter=archived" class="nav-item ms-4 py-2">
                    <i class="fas fa-archive"></i>
                    <span>归档文档</span>
                </a>
            </div>
            
            <div class="nav-section">智能工具</div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseWorkflows" aria-expanded="false">
                <i class="fas fa-project-diagram"></i>
                <span>文档解析工作流</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseWorkflows">
                <a href="{{ url_for('workflow_create') }}?action=list" class="nav-item ms-4 py-2">
                    <i class="fas fa-list"></i>
                    <span>工作流列表</span>
                </a>
                <a href="{{ url_for('workflow_create') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-plus-circle"></i>
                    <span>创建工作流</span>
                </a>
                <a href="{{ url_for('workflow_create') }}?action=history" class="nav-item ms-4 py-2">
                    <i class="fas fa-history"></i>
                    <span>执行历史</span>
                </a>
                <a href="{{ url_for('workflow_create') }}?action=templates" class="nav-item ms-4 py-2">
                    <i class="fas fa-puzzle-piece"></i>
                    <span>模板市场</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseAnalysis" aria-expanded="false">
                <i class="fas fa-chart-line"></i>
                <span>AI分析</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseAnalysis">
                <a href="{{ url_for('ai_analysis') }}?type=contract" class="nav-item ms-4 py-2">
                    <i class="fas fa-file-contract"></i>
                    <span>合同分析</span>
                </a>
                <a href="{{ url_for('ai_analysis') }}?type=finance" class="nav-item ms-4 py-2">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>财务文档分析</span>
                </a>
                <a href="{{ url_for('ai_analysis') }}?type=medical" class="nav-item ms-4 py-2">
                    <i class="fas fa-file-medical"></i>
                    <span>医疗文档分析</span>
                </a>
                <a href="{{ url_for('ai_analysis') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-file-alt"></i>
                    <span>通用文档分析</span>
                </a>
            </div>
            
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseAgentChat" aria-expanded="false">
                <i class="fas fa-robot"></i>
                <span>Agent Chat</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseAgentChat">
                <a href="{{ url_for('agent_chat') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-comments"></i>
                    <span>新会话</span>
                </a>
                <a href="{{ url_for('agent_chat') }}?view=history" class="nav-item ms-4 py-2">
                    <i class="fas fa-history"></i>
                    <span>会话历史</span>
                </a>
                <a href="{{ url_for('multi_agent_workshop') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-users-cog"></i>
                    <span>多Agent协作</span>
                </a>
                <a href="{{ url_for('agent_settings') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-tools"></i>
                    <span>Agent设置</span>
                </a>
            </div>
            
            <div class="nav-section">设置</div>
            <div class="nav-item" data-bs-toggle="collapse" data-bs-target="#collapseSettings" aria-expanded="false">
                <i class="fas fa-user-cog"></i>
                <span>账户设置</span>
                <i class="fas fa-chevron-down ms-auto"></i>
            </div>
            <div class="collapse" id="collapseSettings">
                <a href="{{ url_for('account_settings') }}" class="nav-item ms-4 py-2">
                    <i class="fas fa-user"></i>
                    <span>个人资料</span>
                </a>
                <a href="{{ url_for('account_settings') }}?tab=security" class="nav-item ms-4 py-2">
                    <i class="fas fa-shield-alt"></i>
                    <span>安全设置</span>
                </a>
                <a href="{{ url_for('account_settings') }}?tab=subscription" class="nav-item ms-4 py-2">
                    <i class="fas fa-credit-card"></i>
                    <span>订阅计划</span>
                </a>
                <a href="{{ url_for('account_settings') }}?tab=team" class="nav-item ms-4 py-2">
                    <i class="fas fa-users"></i>
                    <span>团队管理</span>
                </a>
                <a href="{{ url_for('account_settings') }}?tab=api" class="nav-item ms-4 py-2">
                    <i class="fas fa-key"></i>
                    <span>API密钥</span>
                </a>
            </div>
            
            <a href="{{ url_for('notifications') }}" class="nav-item" id="notificationsLink" onclick="window.location.href='{{ url_for('notifications') }}'">
                <i class="fas fa-bell"></i>
                <span>通知中心</span>
            </a>
            <a href="{{ url_for('logout') }}" class="nav-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>退出登录</span>
            </a>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="content-header">
            <h1 class="page-title">仪表板</h1>
            <div class="d-flex align-items-center">
                <div class="dropdown">
                    <button class="btn btn-link text-dark p-0" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                        <li><a class="dropdown-item" href="{{ url_for('account_settings') }}"><i class="fas fa-user-cog me-2"></i> 个人设置</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('notifications') }}"><i class="fas fa-bell me-2"></i> 通知中心</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt me-2"></i> 退出登录</a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- MVP Welcome Banner -->
        <div class="alert alert-info mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px;">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="20" cy="20" r="18" fill="rgba(255,255,255,0.2)"/>
                        <path d="M20 8L23.6 14.8L32 14.8L26.4 19.2L30 26L20 21.6L10 26L13.6 19.2L8 14.8L16.4 14.8L20 8Z" fill="white"/>
                    </svg>
                </div>
                <div class="flex-grow-1">
                    <h4 class="mb-1">🎉 欢迎体验iDOC智能文档处理平台</h4>
                    <p class="mb-2">您正在使用MVP演示版本，所有核心功能均可免费体验</p>
                    <div class="d-flex flex-wrap gap-2">
                        <span class="badge bg-light text-dark">AI智能分析</span>
                        <span class="badge bg-light text-dark">Agent对话</span>
                        <span class="badge bg-light text-dark">知识库管理</span>
                        <span class="badge bg-light text-dark">智能流程</span>
                    </div>
                </div>
                <div class="ms-3">
                    <a href="{{ url_for('ai_analysis') }}" class="btn btn-light btn-sm">开始体验</a>
                </div>
            </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value">0</div>
                <div class="stat-label">总文档数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">0</div>
                <div class="stat-label">已处理页数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">0</div>
                <div class="stat-label">知识库条目</div>
            </div>
            <div class="stat-card" style="cursor: pointer;" onclick="window.location.href='{{ url_for('notifications') }}'">
                <div class="stat-value"><i class="fas fa-bell"></i></div>
                <div class="stat-label">通知中心</div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="feature-section">
            <div class="feature-section-header">
                <h3 class="feature-title">
                    <div class="feature-title-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    快速操作
                </h3>
            </div>
            
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-file-upload"></i>
                        </div>
                        <div class="quick-action-content">
                            <h5 class="quick-action-title">上传文档</h5>
                            <p class="quick-action-desc">添加新文档到您的工作区</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <div class="quick-action-content">
                            <h5 class="quick-action-title">创建工作流</h5>
                            <p class="quick-action-desc">设置自动化文档处理流程</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="quick-action-card">
                        <div class="quick-action-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="quick-action-content">
                            <h5 class="quick-action-title">AI 分析</h5>
                            <p class="quick-action-desc">获取文档的智能洞察和建议</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mt-4">
                    <a href="{{ url_for('multi_agent_workshop') }}" class="text-decoration-none">
                        <div class="quick-action-card">
                            <div class="quick-action-icon" style="background-color: rgba(139, 92, 246, 0.1); color: #8B5CF6;">
                                <i class="fas fa-users-cog"></i>
                            </div>
                            <div class="quick-action-content">
                                <h5 class="quick-action-title">多Agent协作</h5>
                                <p class="quick-action-desc">多个专业AI共同协作分析您的文档</p>
                            </div>
                        </div>
                    </a>
                </div>
                
                <div class="col-md-4 mt-4">
                    <a href="{{ url_for('agent_chat') }}" class="text-decoration-none">
                        <div class="quick-action-card">
                            <div class="quick-action-icon" style="background-color: rgba(16, 185, 129, 0.1); color: #10B981;">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="quick-action-content">
                                <h5 class="quick-action-title">Agent Chat</h5>
                                <p class="quick-action-desc">与AI助手进行自然语言对话</p>
                            </div>
                        </div>
                    </a>
                </div>
                
                <div class="col-md-4 mt-4">
                    <a href="{{ url_for('knowledge_base') }}" class="text-decoration-none">
                        <div class="quick-action-card">
                            <div class="quick-action-icon" style="background-color: rgba(245, 158, 11, 0.1); color: #F59E0B;">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="quick-action-content">
                                <h5 class="quick-action-title">知识库管理</h5>
                                <p class="quick-action-desc">智能文档分类和语义搜索</p>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Recent Documents -->
        <div class="feature-section">
            <div class="feature-section-header">
                <h3 class="feature-title">
                    <div class="feature-title-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    最近文档
                </h3>
                <a href="#" class="btn btn-sm btn-outline-primary">查看全部</a>
            </div>
            
            <div class="dashboard-card">
                <div class="dashboard-card-body">
                    <div class="empty-state">
                        <div class="mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" class="bi bi-file-earmark-plus text-muted" viewBox="0 0 16 16">
                                <path d="M8 6.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 .5-.5z"/>
                                <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                            </svg>
                        </div>
                        <h5>暂无文档</h5>
                        <p class="text-muted mb-4">上传文档以开始使用AI文档智能分析</p>
                        
                        <div class="upload-zone p-4 border border-dashed rounded mb-3" style="border-color: #4A6CF7;">
                            <div class="text-center">
                                <i class="fas fa-cloud-upload-alt text-primary fa-2x mb-3"></i>
                                <p class="mb-1">拖放文件到此处或</p>
                                <button class="btn btn-primary">
                                    <i class="fas fa-upload me-1"></i> 选择文件
                                </button>
                                <p class="text-muted mt-2"><small>支持 PDF, Word, Excel, 图片等格式</small></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row g-4 mt-2">
            <!-- Document Workflows -->
            <div class="col-lg-6">
                <div class="feature-section">
                    <div class="feature-section-header">
                        <h3 class="feature-title">
                            <div class="feature-title-icon">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            文档解析工作流
                        </h3>
                        <a href="#" class="btn btn-sm btn-outline-primary">管理工作流</a>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="dashboard-card-body">
                            <div class="text-center py-4">
                                <i class="fas fa-project-diagram text-muted fa-3x mb-3"></i>
                                <h5>创建新的文档处理工作流</h5>
                                <p class="text-muted mb-4">设置自动化工作流以处理和分析文档</p>
                                <button class="btn btn-primary mb-3">
                                    <i class="fas fa-plus me-1"></i> 创建工作流
                                </button>
                            </div>
                            
                            <div class="mt-4">
                                <h6>推荐工作流模板</h6>
                                <div class="list-group mt-3">
                                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <i class="fas fa-file-invoice text-primary me-2"></i>
                                            <span>发票处理</span>
                                        </div>
                                        <span class="badge rounded-pill bg-light text-dark">使用</span>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <i class="fas fa-file-contract text-primary me-2"></i>
                                            <span>合同审核</span>
                                        </div>
                                        <span class="badge rounded-pill bg-light text-dark">使用</span>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <i class="fas fa-file-medical text-primary me-2"></i>
                                            <span>医疗文档分析</span>
                                        </div>
                                        <span class="badge rounded-pill bg-light text-dark">使用</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI Analysis Insights -->
            <div class="col-lg-6">
                <div class="feature-section">
                    <div class="feature-section-header">
                        <h3 class="feature-title">
                            <div class="feature-title-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            AI 分析洞察
                        </h3>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="insightsPeriodDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                本周
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="insightsPeriodDropdown">
                                <li><a class="dropdown-item" href="#">今天</a></li>
                                <li><a class="dropdown-item" href="#">本周</a></li>
                                <li><a class="dropdown-item" href="#">本月</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#">所有时间</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="dashboard-card-body">
                            <div class="text-center py-4">
                                <i class="fas fa-chart-line text-muted fa-3x mb-3"></i>
                                <h5>暂无分析数据</h5>
                                <p class="text-muted">上传并处理文档后查看AI分析洞察</p>
                            </div>
                            
                            <div class="mt-4">
                                <h6>推荐分析模式</h6>
                                <div class="row g-3 mt-2">
                                    <div class="col-md-6">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body p-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="rounded-circle bg-primary bg-opacity-10 p-2 d-flex me-3">
                                                        <i class="fas fa-search-dollar text-primary"></i>
                                                    </div>
                                                    <div>
                                                        <h6 class="mb-1">财务分析</h6>
                                                        <p class="text-muted mb-0 small">自动提取和分析财务数据</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body p-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="rounded-circle bg-primary bg-opacity-10 p-2 d-flex me-3">
                                                        <i class="fas fa-file-contract text-primary"></i>
                                                    </div>
                                                    <div>
                                                        <h6 class="mb-1">合同风险评估</h6>
                                                        <p class="text-muted mb-0 small">识别合同中的潜在风险条款</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 账户信息 -->
        <div class="row mt-4">
            <div class="col-lg-4">
                <div class="feature-section">
                    <div class="feature-section-header">
                        <h3 class="feature-title">
                            <div class="feature-title-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            账户信息
                        </h3>
                        <a href="#" class="btn btn-sm btn-outline-secondary">编辑</a>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="dashboard-card-body">
                            <div class="d-flex align-items-center mb-3">
                                <div class="flex-shrink-0">
                                    {% if current_user.profile_image_url %}
                                    <img src="{{ current_user.profile_image_url }}" alt="Profile" class="rounded-circle" width="60" height="60" style="object-fit: cover;">
                                    {% else %}
                                    <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                        {{ current_user.first_name[0] }}{{ current_user.last_name[0] if current_user.last_name else '' }}
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h5 class="mb-0">{{ current_user.first_name }} {{ current_user.last_name }}</h5>
                                    <p class="text-muted mb-0">{{ current_user.email }}</p>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <p class="mb-1"><strong>账户类型:</strong></p>
                                <p class="mb-0">
                                    {% if current_user.is_enterprise %}
                                    <span class="badge bg-primary">企业版</span>
                                    {% else %}
                                    <span class="badge bg-secondary">标准版</span>
                                    {% endif %}
                                </p>
                            </div>
                            
                            <div class="mb-3">
                                <p class="mb-1"><strong>上次登录:</strong></p>
                                <p class="mb-0 text-muted">
                                    {% if current_user.last_login %}
                                    {{ current_user.last_login.strftime('%Y年%m月%d日 %H:%M') }}
                                    {% else %}
                                    首次登录
                                    {% endif %}
                                </p>
                            </div>
                            
                            {% if current_user.is_enterprise and current_user.enterprise_profile %}
                            <hr>
                            <h6 class="mb-3">企业信息</h6>
                            
                            <div class="mb-3">
                                <p class="mb-1"><small class="text-muted">公司名称:</small></p>
                                <p class="mb-0">{{ current_user.enterprise_profile.company_name }}</p>
                            </div>
                            
                            <div class="mb-3">
                                <p class="mb-1"><small class="text-muted">行业:</small></p>
                                <p class="mb-0">{{ current_user.enterprise_profile.industry }}</p>
                            </div>
                            
                            <div class="mb-3">
                                <p class="mb-1"><small class="text-muted">公司规模:</small></p>
                                <p class="mb-0">{{ current_user.enterprise_profile.company_size }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-8">
                <div class="feature-section">
                    <div class="feature-section-header">
                        <h3 class="feature-title">
                            <div class="feature-title-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            企业知识库
                        </h3>
                        <a href="#" class="btn btn-sm btn-primary">添加知识</a>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="dashboard-card-body">
                            <div class="text-center py-4">
                                <i class="fas fa-book text-muted fa-3x mb-3"></i>
                                <h5>暂无知识库条目</h5>
                                <p class="text-muted mb-4">添加企业文档到知识库，让AI助手利用您的专业知识</p>
                                <button class="btn btn-primary">
                                    <i class="fas fa-plus me-1"></i> 创建企业知识库
                                </button>
                            </div>
                            
                            <div class="mt-4">
                                <h6>知识库功能</h6>
                                <div class="row g-3 mt-2">
                                    <div class="col-md-6">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body p-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="rounded-circle bg-primary bg-opacity-10 p-2 d-flex me-3">
                                                        <i class="fas fa-robot text-primary"></i>
                                                    </div>
                                                    <div>
                                                        <h6 class="mb-1">AI 问答</h6>
                                                        <p class="text-muted mb-0 small">基于企业知识库回答问题</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body p-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="rounded-circle bg-primary bg-opacity-10 p-2 d-flex me-3">
                                                        <i class="fas fa-search text-primary"></i>
                                                    </div>
                                                    <div>
                                                        <h6 class="mb-1">语义搜索</h6>
                                                        <p class="text-muted mb-0 small">在所有文档中进行智能搜索</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 悬浮 AI 助手 按钮 -->
        <div class="ai-assistant-fab" id="aiAssistantBtn">
            <i class="fas fa-robot fa-lg"></i>
        </div>
        
        <!-- 悬浮 AI 助手面板 -->
        <div class="ai-assistant-panel" id="aiAssistantPanel">
            <div class="ai-assistant-header">
                <div class="d-flex align-items-center">
                    <div class="rounded-circle bg-white text-primary d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h5 class="mb-0">智能文档助手</h5>
                </div>
                <button type="button" class="btn-close btn-close-white" id="closeAssistantBtn"></button>
            </div>
            
            <div class="ai-assistant-body" id="chatMessages">
                <div class="chat-message-bot">
                    <div class="chat-bubble-bot">
                        <p class="mb-0">您好！我是iDOC智能文档助手。我可以帮您分析文档、提取信息、比较文件或回答问题。您可以告诉我您想处理什么文档，或者有什么需要帮助的。</p>
                    </div>
                </div>
            </div>
            
            <div class="ai-assistant-footer">
                <div class="agent-state-container mb-2 p-2 rounded border" style="display: none; background-color: #f8f9fa;">
                    <small><i class="fas fa-spinner fa-spin me-2"></i><span class="agent-state-text">正在分析文档第3页...</span></small>
                </div>
                
                <div class="input-group">
                    <input type="text" class="form-control" id="userInput" placeholder="输入您的问题或指令...">
                    <button class="btn btn-primary" id="sendMessageBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="text-center mt-2">
                    <small class="text-muted">常用: 
                        <a href="#" class="text-decoration-none quick-prompt">分析文档</a> · 
                        <a href="#" class="text-decoration-none quick-prompt">提取关键信息</a> · 
                        <a href="#" class="text-decoration-none quick-prompt">比较文件</a>
                    </small>
                </div>
            </div>
        </div>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const aiAssistantBtn = document.getElementById('aiAssistantBtn');
                const aiAssistantPanel = document.getElementById('aiAssistantPanel');
                const closeAssistantBtn = document.getElementById('closeAssistantBtn');
                const sendMessageBtn = document.getElementById('sendMessageBtn');
                const userInput = document.getElementById('userInput');
                const chatMessages = document.getElementById('chatMessages');
                
                // 打开助手面板
                aiAssistantBtn.addEventListener('click', function() {
                    aiAssistantPanel.style.display = 'flex';
                    aiAssistantBtn.style.display = 'none';
                });
                
                // 关闭助手面板
                closeAssistantBtn.addEventListener('click', function() {
                    aiAssistantPanel.style.display = 'none';
                    aiAssistantBtn.style.display = 'flex';
                });
                
                // 发送消息
                function sendMessage() {
                    const message = userInput.value.trim();
                    if (message) {
                        // 添加用户消息
                        const userMessageDiv = document.createElement('div');
                        userMessageDiv.className = 'chat-message-user';
                        
                        const chatBubble = document.createElement('div');
                        chatBubble.className = 'chat-bubble-user';
                        chatBubble.innerHTML = `<p class="mb-0">${message}</p>`;
                        
                        userMessageDiv.appendChild(chatBubble);
                        chatMessages.appendChild(userMessageDiv);
                        
                        // 清空输入框
                        userInput.value = '';
                        
                        // 滚动到底部
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        
                        // 显示思考状态
                        document.querySelector('.agent-state-container').style.display = 'block';
                        
                        // 模拟AI回复（实际中应该是API调用）
                        setTimeout(function() {
                            // 隐藏思考状态
                            document.querySelector('.agent-state-container').style.display = 'none';
                            
                            // 添加机器人回复
                            const botMessageDiv = document.createElement('div');
                            botMessageDiv.className = 'chat-message-bot';
                            
                            const botChatBubble = document.createElement('div');
                            botChatBubble.className = 'chat-bubble-bot';
                            botChatBubble.innerHTML = `<p class="mb-0">我已收到您的指令："${message}"。作为演示，这是一个预设回复。在实际应用中，我会根据您的具体问题和上传的文档提供相应的回答和分析。</p>`;
                            
                            botMessageDiv.appendChild(botChatBubble);
                            chatMessages.appendChild(botMessageDiv);
                            
                            // 滚动到底部
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }, 1500);
                    }
                }
                
                // 发送按钮点击事件
                sendMessageBtn.addEventListener('click', sendMessage);
                
                // 输入框回车事件
                userInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
                
                // 快速提示点击事件
                document.querySelectorAll('.quick-prompt').forEach(function(prompt) {
                    prompt.addEventListener('click', function(e) {
                        e.preventDefault();
                        userInput.value = this.textContent;
                        sendMessage();
                    });
                });
            });
        </script>
    </div>
</div>
{% endblock %}
